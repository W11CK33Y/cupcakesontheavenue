<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Advanced Admin Dashboard - Cupcakes on the Avenue</title>
<link rel="icon" type="image/x-icon" href="pictures/favicon.ico">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  color: #333;
}

/* Login Screen */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.login-box {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  max-width: 400px;
  width: 100%;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.login-box h1 {
  color: #667eea;
  margin-bottom: 30px;
  font-size: 2rem;
}

.login-box input {
  width: 100%;
  padding: 15px;
  margin: 10px 0;
  border: 2px solid rgba(102, 126, 234, 0.2);
  border-radius: 10px;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.8);
}

.login-box input:focus {
  border-color: #667eea;
  outline: none;
  background: white;
}

.login-btn {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  transition: transform 0.2s ease;
}

.login-btn:hover {
  transform: translateY(-2px);
}

.error-message {
  color: #dc3545;
  margin-top: 10px;
  font-size: 0.9rem;
}

/* Dashboard */
.dashboard {
  display: none;
  padding: 20px;
  max-width: 1600px;
  margin: 0 auto;
}

.dashboard-header {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  margin-bottom: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.dashboard-header h1 {
  color: #667eea;
  font-size: 2.5rem;
}

.header-controls {
  display: flex;
  gap: 15px;
  align-items: center;
}

.logout-btn, .refresh-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.refresh-btn {
  background: #28a745;
}

.logout-btn:hover, .refresh-btn:hover {
  transform: translateY(-2px);
}

/* Navigation Tabs */
.nav-tabs {
  display: flex;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 10px;
  margin-bottom: 30px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  overflow-x: auto;
  gap: 5px;
}

.nav-tab {
  background: transparent;
  border: none;
  padding: 12px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  color: #667eea;
  transition: all 0.3s ease;
  white-space: nowrap;
  min-width: fit-content;
}

.nav-tab.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  transform: translateY(-2px);
}

.nav-tab:hover:not(.active) {
  background: rgba(102, 126, 234, 0.1);
}

/* Tab Content */
.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Dashboard Cards */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-bottom: 30px;
}

.dashboard-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: transform 0.3s ease;
}

.dashboard-card:hover {
  transform: translateY(-5px);
}

.dashboard-card h2 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.stat-item:last-child {
  border-bottom: none;
}

.stat-value {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
}

/* Charts */
.chart-container {
  position: relative;
  height: 300px;
  margin-top: 20px;
}

/* Tables */
.table-container {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  overflow-x: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.data-table th,
.data-table td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.data-table th {
  background: rgba(102, 126, 234, 0.1);
  font-weight: bold;
  color: #667eea;
  position: sticky;
  top: 0;
}

.data-table tr:hover {
  background: rgba(102, 126, 234, 0.05);
}

/* Status Badges */
.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: bold;
  text-transform: uppercase;
}

.status-pending { background: #fff3cd; color: #856404; }
.status-confirmed { background: #d4edda; color: #155724; }
.status-completed { background: #cce5ff; color: #004085; }
.status-cancelled { background: #f8d7da; color: #721c24; }
.status-paid { background: #d1ecf1; color: #0c5460; }
.status-unpaid { background: #ffeaa7; color: #856404; }

/* Action Buttons */
.action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: bold;
  margin: 2px;
  transition: all 0.2s ease;
}

.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: #212529; }
.btn-danger { background: #dc3545; color: white; }
.btn-info { background: #17a2b8; color: white; }

.action-btn:hover {
  transform: translateY(-1px);
  opacity: 0.9;
}

/* Forms */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #555;
}

.form-control {
  width: 100%;
  padding: 12px;
  border: 2px solid rgba(102, 126, 234, 0.2);
  border-radius: 8px;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.8);
}

.form-control:focus {
  border-color: #667eea;
  outline: none;
  background: white;
}

/* Calendar */
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
}

.calendar-header {
  background: #667eea;
  color: white;
  padding: 10px;
  text-align: center;
  font-weight: bold;
}

.calendar-day {
  background: white;
  padding: 10px;
  min-height: 60px;
  border: 1px solid #eee;
  position: relative;
  cursor: pointer;
}

.calendar-day:hover {
  background: #f8f9fa;
}

.calendar-day.has-orders {
  background: rgba(102, 126, 234, 0.1);
}

.calendar-day.blocked {
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
}

.order-dot {
  width: 8px;
  height: 8px;
  background: #667eea;
  border-radius: 50%;
  position: absolute;
  top: 5px;
  right: 5px;
}

/* Notifications */
.notification-panel {
  position: fixed;
  top: 20px;
  right: 20px;
  max-width: 350px;
  z-index: 1000;
}

.notification {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-left: 4px solid #667eea;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  animation: slideIn 0.3s ease;
}

.notification.success { border-left-color: #28a745; }
.notification.warning { border-left-color: #ffc107; }
.notification.error { border-left-color: #dc3545; }

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 20px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.close-modal {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #999;
}

.close-modal:hover {
  color: #333;
}

/* Responsive */
@media (max-width: 768px) {
  .dashboard {
    padding: 10px;
  }
  
  .dashboard-header {
    flex-direction: column;
    gap: 20px;
    text-align: center;
  }
  
  .nav-tabs {
    padding: 5px;
  }
  
  .nav-tab {
    padding: 8px 12px;
    font-size: 0.9rem;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .data-table {
    font-size: 0.9rem;
  }
  
  .data-table th,
  .data-table td {
    padding: 8px;
  }
}

/* Print Styles */
@media print {
  .nav-tabs, .header-controls, .action-btn {
    display: none !important;
  }
  
  .dashboard-card {
    break-inside: avoid;
  }
}
</style>
</head>
<body>

<!-- Login Screen -->
<div class="login-container" id="loginContainer">
  <div class="login-box">
    <h1>ğŸ” Admin Login</h1>
    <p style="color: #666; margin-bottom: 30px;">Access the comprehensive admin dashboard</p>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit" class="login-btn">Login</button>
      <div class="error-message" id="errorMessage"></div>
    </form>
  </div>
</div>

<!-- Notification Panel -->
<div class="notification-panel" id="notificationPanel"></div>

<!-- Dashboard -->
<div class="dashboard" id="dashboard">
  <div class="dashboard-header">
    <h1>ğŸ§ Admin Dashboard</h1>
    <div class="header-controls">
      <span id="lastUpdate">Last updated: Never</span>
      <button class="refresh-btn" id="refreshAll">ğŸ”„ Refresh</button>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button class="nav-tab active" data-tab="overview">ğŸ“Š Overview</button>
    <button class="nav-tab" data-tab="orders">ğŸ“‹ Orders</button>
    <button class="nav-tab" data-tab="customers">ğŸ‘¥ Customers</button>
    <button class="nav-tab" data-tab="calendar">ğŸ“… Calendar</button>
    <button class="nav-tab" data-tab="analytics">ğŸ“ˆ Analytics</button>
    <button class="nav-tab" data-tab="inventory">ğŸ“¦ Inventory</button>
    <button class="nav-tab" data-tab="finances">ğŸ’° Finances</button>
    <button class="nav-tab" data-tab="communications">ğŸ“± Communications</button>
    <button class="nav-tab" data-tab="settings">âš™ï¸ Settings</button>
  </div>

  <!-- Overview Tab -->
  <div class="tab-content active" id="overview">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“Š Today's Summary</h2>
        <div class="stat-item">
          <span>New Orders</span>
          <span class="stat-value" id="todayOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Revenue</span>
          <span class="stat-value" id="todayRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>Pending Orders</span>
          <span class="stat-value" id="pendingOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Customer Messages</span>
          <span class="stat-value" id="newMessages">0</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ“ˆ This Week</h2>
        <div class="stat-item">
          <span>Total Orders</span>
          <span class="stat-value" id="weekOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Revenue</span>
          <span class="stat-value" id="weekRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>New Customers</span>
          <span class="stat-value" id="newCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Avg Order Value</span>
          <span class="stat-value" id="avgOrderValue">Â£0.00</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ¯ Key Metrics</h2>
        <div class="stat-item">
          <span>Total Customers</span>
          <span class="stat-value" id="totalCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Repeat Customers</span>
          <span class="stat-value" id="repeatCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Monthly Revenue</span>
          <span class="stat-value" id="monthlyRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>Outstanding Payments</span>
          <span class="stat-value" id="outstandingPayments">Â£0.00</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ§ Top Products</h2>
        <div id="topProducts">
          <div class="stat-item">
            <span>Shortbread Delight</span>
            <span class="stat-value">24 sold</span>
          </div>
          <div class="stat-item">
            <span>Vanilla Cupcakes</span>
            <span class="stat-value">18 sold</span>
          </div>
          <div class="stat-item">
            <span>Chocolate Brownies</span>
            <span class="stat-value">15 sold</span>
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-card">
      <h2>ğŸ“ˆ Revenue Chart (Last 7 Days)</h2>
      <div class="chart-container">
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Orders Tab -->
  <div class="tab-content" id="orders">
    <div class="table-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ“‹ Order Management</h2>
        <div>
          <button class="action-btn btn-primary" onclick="exportOrders()">ğŸ“„ Export</button>
          <button class="action-btn btn-success" onclick="addOrder()">â• Add Order</button>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <input type="text" class="form-control" placeholder="ğŸ” Search orders..." id="orderSearch" style="max-width: 300px; display: inline-block; margin-right: 10px;">
        <select class="form-control" id="orderFilter" style="max-width: 200px; display: inline-block;">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>

      <table class="data-table" id="ordersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Payment</th>
            <th>Delivery Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <!-- Orders will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Customers Tab -->
  <div class="tab-content" id="customers">
    <div class="table-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ‘¥ Customer Management</h2>
        <div>
          <button class="action-btn btn-primary" onclick="exportCustomers()">ğŸ“„ Export</button>
          <button class="action-btn btn-success" onclick="addCustomer()">â• Add Customer</button>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <input type="text" class="form-control" placeholder="ğŸ” Search customers..." id="customerSearch" style="max-width: 300px; display: inline-block;">
      </div>

      <table class="data-table" id="customersTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Total Orders</th>
            <th>Total Spent</th>
            <th>Last Order</th>
            <th>Loyalty Points</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="customersTableBody">
          <!-- Customers will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Calendar Tab -->
  <div class="tab-content" id="calendar">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“… Order Calendar</h2>
        <div style="margin-bottom: 20px;">
          <button class="action-btn btn-primary" onclick="prevMonth()">â† Previous</button>
          <span id="currentMonth" style="margin: 0 20px; font-weight: bold;"></span>
          <button class="action-btn btn-primary" onclick="nextMonth()">Next â†’</button>
        </div>
        <div class="calendar" id="orderCalendar">
          <!-- Calendar will be generated here -->
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸš« Blocked Dates</h2>
        <div style="margin-bottom: 20px;">
          <input type="date" class="form-control" id="blockDate" style="margin-bottom: 10px;">
          <button class="action-btn btn-danger" onclick="blockDate()">Block Date</button>
        </div>
        <div id="blockedDatesList">
          <!-- Blocked dates will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Tab -->
  <div class="tab-content" id="analytics">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“Š Sales Analytics</h2>
        <div class="chart-container">
          <canvas id="salesChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ§ Product Performance</h2>
        <div class="chart-container">
          <canvas id="productChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ‘¥ Customer Analytics</h2>
        <div class="chart-container">
          <canvas id="customerChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“ˆ Growth Metrics</h2>
        <div class="stat-item">
          <span>Month-over-Month Growth</span>
          <span class="stat-value">+12.5%</span>
        </div>
        <div class="stat-item">
          <span>Customer Retention Rate</span>
          <span class="stat-value">68%</span>
        </div>
        <div class="stat-item">
          <span>Average Order Frequency</span>
          <span class="stat-value">2.3/month</span>
        </div>
        <div class="stat-item">
          <span>Peak Order Day</span>
          <span class="stat-value">Saturday</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Inventory Tab -->
  <div class="tab-content" id="inventory">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“¦ Stock Levels</h2>
        <div style="margin-bottom: 20px;">
          <button class="action-btn btn-success" onclick="addInventoryItem()">â• Add Item</button>
          <button class="action-btn btn-warning" onclick="generateShoppingList()">ğŸ“ Shopping List</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Current Stock</th>
              <th>Low Stock Alert</th>
              <th>Unit Cost</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="inventoryTableBody">
            <!-- Inventory items will be populated here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Finances Tab -->
  <div class="tab-content" id="finances">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ’° Financial Overview</h2>
        <div class="stat-item">
          <span>Today's Revenue</span>
          <span class="stat-value">Â£156.50</span>
        </div>
        <div class="stat-item">
          <span>This Week</span>
          <span class="stat-value">Â£892.30</span>
        </div>
        <div class="stat-item">
          <span>This Month</span>
          <span class="stat-value">Â£3,245.80</span>
        </div>
        <div class="stat-item">
          <span>Outstanding Payments</span>
          <span class="stat-value">Â£425.00</span>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“Š Payment Tracking</h2>
        <div class="chart-container">
          <canvas id="paymentChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="table-container">
      <h2>ğŸ’³ Payment Management</h2>
      <table class="data-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Total Amount</th>
            <th>Deposit (25%)</th>
            <th>Remaining</th>
            <th>Deposit Status</th>
            <th>Final Payment</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="paymentsTableBody">
          <!-- Payment tracking will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Communications Tab -->
  <div class="tab-content" id="communications">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“± Push Notifications</h2>
        <div class="form-group">
          <label>Notification Type</label>
          <select class="form-control" id="notificationType">
            <option value="weekly-bakes">Weekly Bakes Update</option>
            <option value="new-product">New Product Launch</option>
            <option value="discount">Special Offer</option>
            <option value="market-special">Market Special</option>
            <option value="custom">Custom Message</option>
          </select>
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="notificationMessage" rows="3" placeholder="Enter your notification message..."></textarea>
        </div>
        <button class="action-btn btn-primary" onclick="sendPushNotification()">ğŸ“¤ Send to All</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ‘¤ Individual Customer Contact</h2>
        <div class="form-group">
          <label>Select Customer</label>
          <select class="form-control" id="individualCustomer">
            <option value="">Choose a customer...</option>
          </select>
        </div>
        <div class="form-group">
          <label>Contact Method</label>
          <select class="form-control" id="contactMethod">
            <option value="push">Push Notification</option>
            <option value="email">Email</option>
            <option value="sms">SMS</option>
            <option value="call">Phone Call</option>
          </select>
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="individualMessage" rows="3" placeholder="Personal message to customer..."></textarea>
        </div>
        <div class="form-group">
          <button class="action-btn btn-success" onclick="contactIndividualCustomer()">ğŸ“ Send Message</button>
          <button class="action-btn btn-info" onclick="viewCustomerHistory()">ğŸ“‹ View History</button>
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“§ Email Campaign</h2>
        <div class="form-group">
          <label>Recipients</label>
          <select class="form-control" id="emailRecipients">
            <option value="all">All Customers</option>
            <option value="recent">Recent Customers (30 days)</option>
            <option value="loyal">Loyal Customers</option>
            <option value="inactive">Inactive Customers</option>
          </select>
        </div>
        <div class="form-group">
          <label>Subject</label>
          <input type="text" class="form-control" id="emailSubject" placeholder="Email subject...">
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="emailMessage" rows="4" placeholder="Email content..."></textarea>
        </div>
        <button class="action-btn btn-primary" onclick="sendEmailCampaign()">ğŸ“§ Send Email</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“Š Communication History</h2>
        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Customer</th>
                <th>Method</th>
                <th>Message</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="communicationHistory">
              <!-- Communication history will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <div class="dashboard-card">
      <h2>ğŸ“± Social Media Scheduler</h2>
      <div class="form-group">
        <label>Platform</label>
        <select class="form-control" id="socialPlatform">
          <option value="instagram">Instagram</option>
          <option value="facebook">Facebook</option>
          <option value="twitter">Twitter</option>
        </select>
      </div>
      <div class="form-group">
        <label>Post Content</label>
        <textarea class="form-control" id="socialContent" rows="3" placeholder="What's happening at the bakery..."></textarea>
      </div>
      <div class="form-group">
        <label>Schedule for</label>
        <input type="datetime-local" class="form-control" id="socialSchedule">
      </div>
      <button class="action-btn btn-primary" onclick="scheduleSocialPost()">ğŸ“… Schedule Post</button>
    </div>
  </div>

  <!-- Settings Tab -->
  <div class="tab-content" id="settings">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>âš™ï¸ General Settings</h2>
        <div class="form-group">
          <label>Business Name</label>
          <input type="text" class="form-control" value="Cupcakes on the Avenue" id="businessName">
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="text" class="form-control" value="07842817789" id="businessPhone">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" class="form-control" value="cupcakesontheavenue@gmail.com" id="businessEmail">
        </div>
        <div class="form-group">
          <label>Minimum Lead Time (days)</label>
          <input type="number" class="form-control" value="7" id="leadTime">
        </div>
        <button class="action-btn btn-success" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ”” Notification Settings</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" id="emailNotifications" checked> Email Notifications
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="smsNotifications" checked> SMS Notifications
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="discordNotifications" checked> Discord Notifications
          </label>
        </div>
        <div class="form-group">
          <label>Discord Webhook URL</label>
          <input type="url" class="form-control" id="discordWebhook" value="https://discord.com/api/webhooks/1426192909044023297/Ilgqgr8p7buI95ai-zssfphPLzQlNBBZf6PY31BhVuptPd-ZyccSq5kAQJPoBkUt4PHK">
        </div>
        <button class="action-btn btn-primary" onclick="testDiscordWebhook()">ğŸ§ª Test Discord</button>
      </div>
    </div>
    
    <div class="dashboard-card">
      <h2>ğŸ›¡ï¸ Security</h2>
      <div class="form-group">
        <label>Change Password</label>
        <input type="password" class="form-control" placeholder="New password" id="newPassword">
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" class="form-control" placeholder="Confirm new password" id="confirmPassword">
      </div>
      <button class="action-btn btn-warning" onclick="changePassword()">ğŸ” Change Password</button>
      
      <hr style="margin: 20px 0;">
      
      <div class="form-group">
        <label>Data Backup</label>
        <button class="action-btn btn-info" onclick="backupData()">ğŸ’¾ Download Backup</button>
        <button class="action-btn btn-warning" onclick="restoreData()">ğŸ“¥ Restore Data</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Modal Title</h3>
      <button class="close-modal" onclick="closeModal()">&times;</button>
    </div>
    <div id="modalBody">
      <!-- Modal content will be populated here -->
    </div>
  </div>
</div>

<script>
// Global variables
let currentUser = null;
let orders = JSON.parse(localStorage.getItem('adminOrders') || '[]');
let customers = JSON.parse(localStorage.getItem('adminCustomers') || '[]');
let inventory = JSON.parse(localStorage.getItem('adminInventory') || '[]');
let blockedDates = JSON.parse(localStorage.getItem('adminBlockedDates') || '[]');
let currentDate = new Date();
let charts = {};

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
  initializeApp();
  setupEventListeners();
  generateSampleData();
});

function initializeApp() {
  // Check if user is already logged in
  const savedUser = localStorage.getItem('adminUser');
  if (savedUser) {
    currentUser = JSON.parse(savedUser);
    showDashboard();
  }
}

function setupEventListeners() {
  // Login form
  document.getElementById('loginForm').addEventListener('submit', handleLogin);
  
  // Logout button
  document.getElementById('logoutBtn').addEventListener('click', logout);
  
  // Refresh button
  document.getElementById('refreshAll').addEventListener('click', refreshAllData);
  
  // Tab navigation
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
  });
  
  // Search and filter
  document.getElementById('orderSearch')?.addEventListener('input', filterOrders);
  document.getElementById('orderFilter')?.addEventListener('change', filterOrders);
  document.getElementById('customerSearch')?.addEventListener('input', filterCustomers);
}

function handleLogin(e) {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  
  // Simple authentication (in production, use proper authentication)
  if (username === 'admin' && password === 'cupcakes2025') {
    currentUser = { username, loginTime: new Date() };
    localStorage.setItem('adminUser', JSON.stringify(currentUser));
    showDashboard();
    showNotification('Welcome to the admin dashboard!', 'success');
  } else {
    document.getElementById('errorMessage').textContent = 'Invalid credentials';
  }
}

function logout() {
  localStorage.removeItem('adminUser');
  currentUser = null;
  document.getElementById('loginContainer').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
  showNotification('Logged out successfully', 'success');
}

function showDashboard() {
  document.getElementById('loginContainer').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  loadDashboardData();
  initializeCharts();
  updateLastUpdateTime();
}

function switchTab(tabName) {
  // Update tab buttons
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
  
  // Update tab content
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  document.getElementById(tabName).classList.add('active');
  
  // Load specific tab data
  switch(tabName) {
    case 'calendar':
      generateCalendar();
      break;
    case 'analytics':
      updateAnalyticsCharts();
      break;
    case 'inventory':
      loadInventoryData();
      break;
    case 'finances':
      loadFinancialData();
      break;
  }
}

function loadDashboardData() {
  updateOverviewStats();
  loadOrdersTable();
  loadCustomersTable();
}

function updateOverviewStats() {
  const today = new Date();
  const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  const weekStart = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
  
  // Today's stats
  const todayOrders = orders.filter(o => new Date(o.date) >= todayStart);
  document.getElementById('todayOrders').textContent = todayOrders.length;
  document.getElementById('todayRevenue').textContent = 'Â£' + todayOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0).toFixed(2);
  
  // Week's stats
  const weekOrders = orders.filter(o => new Date(o.date) >= weekStart);
  document.getElementById('weekOrders').textContent = weekOrders.length;
  document.getElementById('weekRevenue').textContent = 'Â£' + weekOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0).toFixed(2);
  
  // Other stats
  document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
  document.getElementById('totalCustomers').textContent = customers.length;
  document.getElementById('newCustomers').textContent = customers.filter(c => new Date(c.joinDate) >= weekStart).length;
  
  const avgOrder = weekOrders.length > 0 ? weekOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0) / weekOrders.length : 0;
  document.getElementById('avgOrderValue').textContent = 'Â£' + avgOrder.toFixed(2);
  
  const monthlyTotal = orders.filter(o => {
    const orderDate = new Date(o.date);
    return orderDate.getMonth() === today.getMonth() && orderDate.getFullYear() === today.getFullYear();
  }).reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
  document.getElementById('monthlyRevenue').textContent = 'Â£' + monthlyTotal.toFixed(2);
  
  const outstandingPayments = orders.filter(o => o.paymentStatus !== 'paid').reduce((sum, o) => sum + parseFloat(o.remaining || 0), 0);
  document.getElementById('outstandingPayments').textContent = 'Â£' + outstandingPayments.toFixed(2);
}

function loadOrdersTable() {
  const tbody = document.getElementById('ordersTableBody');
  tbody.innerHTML = '';
  
  orders.forEach(order => {
    const deliveryMethod = order.deliveryMethod || 'delivery';
    const methodIcon = deliveryMethod === 'delivery' ? 'ğŸšš' : 'ğŸª';
    
    // Calculate days until delivery
    const today = new Date();
    const deliveryDate = new Date(order.deliveryDate);
    const daysUntil = Math.ceil((deliveryDate - deliveryDate) / (1000 * 60 * 60 * 24));
    
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>#${order.id}</td>
      <td>${order.customerName}<br><small>${order.customerEmail || ''}</small></td>
      <td>${order.items}</td>
      <td>Â£${order.total}<br><small>${methodIcon} ${deliveryMethod}</small></td>
      <td><span class="status-badge status-${order.status}">${order.status}</span></td>
      <td><span class="status-badge status-${order.paymentStatus}">${order.paymentStatus}</span></td>
      <td>${order.deliveryDate}<br><small>${order.reminderSent ? 'âœ… Reminder sent' : 'ğŸ“… No reminder'}</small></td>
      <td>
        <button class="action-btn btn-info" onclick="viewOrder('${order.id}')">ğŸ‘ï¸</button>
        <button class="action-btn btn-success" onclick="updateOrderStatus('${order.id}', 'confirmed')">âœ…</button>
        <button class="action-btn btn-warning" onclick="updateOrderStatus('${order.id}', 'completed')">ğŸ¯</button>
        <button class="action-btn btn-primary" onclick="sendManualReminder('${order.id}')" title="Send Reminder">ğŸ“±</button>
        <button class="action-btn btn-danger" onclick="deleteOrder('${order.id}')">ğŸ—‘ï¸</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

function loadCustomersTable() {
  const tbody = document.getElementById('customersTableBody');
  tbody.innerHTML = '';
  
  customers.forEach(customer => {
    const customerOrders = orders.filter(o => o.customerEmail === customer.email);
    const totalSpent = customerOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
    const lastOrder = customerOrders.length > 0 ? new Date(Math.max(...customerOrders.map(o => new Date(o.date)))).toLocaleDateString() : 'Never';
    
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${customer.name}</td>
      <td>${customer.email}</td>
      <td>${customer.phone}</td>
      <td>${customerOrders.length}</td>
      <td>Â£${totalSpent.toFixed(2)}</td>
      <td>${lastOrder}</td>
      <td>${customer.loyaltyPoints || 0}</td>
      <td>
        <button class="action-btn btn-info" onclick="viewCustomer('${customer.email}')">ğŸ‘ï¸</button>
        <button class="action-btn btn-primary" onclick="contactCustomer('${customer.email}')">ğŸ“</button>
        <button class="action-btn btn-danger" onclick="deleteCustomer('${customer.email}')">ğŸ—‘ï¸</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

function generateCalendar() {
  const calendar = document.getElementById('orderCalendar');
  calendar.innerHTML = '';
  
  // Add headers
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  days.forEach(day => {
    const header = document.createElement('div');
    header.className = 'calendar-header';
    header.textContent = day;
    calendar.appendChild(header);
  });
  
  // Add calendar days
  const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
  const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());
  
  for (let i = 0; i < 42; i++) {
    const cellDate = new Date(startDate);
    cellDate.setDate(startDate.getDate() + i);
    
    const cell = document.createElement('div');
    cell.className = 'calendar-day';
    cell.textContent = cellDate.getDate();
    
    // Check if this date has orders
    const dateStr = cellDate.toISOString().split('T')[0];
    const dayOrders = orders.filter(o => o.deliveryDate === dateStr);
    
    if (dayOrders.length > 0) {
      cell.classList.add('has-orders');
      const dot = document.createElement('div');
      dot.className = 'order-dot';
      cell.appendChild(dot);
    }
    
    // Check if this date is blocked
    if (blockedDates.includes(dateStr)) {
      cell.classList.add('blocked');
    }
    
    cell.addEventListener('click', () => showDayDetails(dateStr));
    calendar.appendChild(cell);
  }
  
  // Update month display
  document.getElementById('currentMonth').textContent = 
    currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
}

function initializeCharts() {
  // Revenue Chart
  const revenueCtx = document.getElementById('revenueChart').getContext('2d');
  charts.revenue = new Chart(revenueCtx, {
    type: 'line',
    data: {
      labels: getLast7Days(),
      datasets: [{
        label: 'Daily Revenue',
        data: generateRevenueData(),
        borderColor: '#667eea',
        backgroundColor: 'rgba(102, 126, 234, 0.1)',
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return 'Â£' + value;
            }
          }
        }
      }
    }
  });
}

function updateAnalyticsCharts() {
  // Sales Chart
  const salesCtx = document.getElementById('salesChart')?.getContext('2d');
  if (salesCtx && !charts.sales) {
    charts.sales = new Chart(salesCtx, {
      type: 'bar',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'Monthly Sales',
          data: [1200, 1900, 3000, 2100, 3200, 2800],
          backgroundColor: 'rgba(102, 126, 234, 0.8)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
  }
  
  // Product Chart
  const productCtx = document.getElementById('productChart')?.getContext('2d');
  if (productCtx && !charts.product) {
    charts.product = new Chart(productCtx, {
      type: 'doughnut',
      data: {
        labels: ['Shortbread Delight', 'Cupcakes', 'Brownies', 'Biscuits'],
        datasets: [{
          data: [35, 25, 20, 20],
          backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
  }
}

function generateSampleData() {
  if (orders.length === 0) {
    // Generate sample orders
    const sampleOrders = [
      {
        id: 'ORD-001',
        customerName: 'Sarah Johnson',
        customerEmail: 'sarah@email.com',
        items: 'Shortbread Delight x6, Vanilla Cupcakes x12',
        total: '45.50',
        status: 'confirmed',
        paymentStatus: 'paid',
        deliveryDate: '2025-11-05',
        date: '2025-10-28',
        deposit: '11.38',
        remaining: '0.00'
      },
      {
        id: 'ORD-002',
        customerName: 'Mike Wilson',
        customerEmail: 'mike@email.com',
        items: 'Chocolate Brownies x8',
        total: '24.00',
        status: 'pending',
        paymentStatus: 'deposit-paid',
        deliveryDate: '2025-11-03',
        date: '2025-10-30',
        deposit: '6.00',
        remaining: '18.00'
      }
    ];
    orders = sampleOrders;
    localStorage.setItem('adminOrders', JSON.stringify(orders));
  }
  
  if (customers.length === 0) {
    // Generate sample customers
    const sampleCustomers = [
      {
        name: 'Sarah Johnson',
        email: 'sarah@email.com',
        phone: '07123456789',
        joinDate: '2025-09-15',
        loyaltyPoints: 120
      },
      {
        name: 'Mike Wilson',
        email: 'mike@email.com',
        phone: '07987654321',
        joinDate: '2025-10-20',
        loyaltyPoints: 45
      }
    ];
    customers = sampleCustomers;
    localStorage.setItem('adminCustomers', JSON.stringify(customers));
  }
  
  if (inventory.length === 0) {
    // Generate sample inventory
    const sampleInventory = [
      { name: 'Flour', currentStock: 25, lowStockAlert: 5, unitCost: 1.20, unit: 'kg' },
      { name: 'Sugar', currentStock: 15, lowStockAlert: 3, unitCost: 0.80, unit: 'kg' },
      { name: 'Butter', currentStock: 8, lowStockAlert: 2, unitCost: 3.50, unit: 'kg' },
      { name: 'Eggs', currentStock: 60, lowStockAlert: 12, unitCost: 0.25, unit: 'each' }
    ];
    inventory = sampleInventory;
    localStorage.setItem('adminInventory', JSON.stringify(inventory));
  }
}

// Utility functions
function getLast7Days() {
  const days = [];
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
  }
  return days;
}

function generateRevenueData() {
  return [125, 89, 156, 203, 178, 245, 190];
}

function updateLastUpdateTime() {
  document.getElementById('lastUpdate').textContent = 
    'Last updated: ' + new Date().toLocaleTimeString();
}

function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
    <p>${message}</p>
  `;
  
  document.getElementById('notificationPanel').appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 5000);
}

function refreshAllData() {
  loadDashboardData();
  updateLastUpdateTime();
  showNotification('All data refreshed successfully!', 'success');
}

// Modal functions
function showModal(title, content) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').innerHTML = content;
  document.getElementById('modal').style.display = 'block';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

// Action functions
function viewOrder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (order) {
    const content = `
      <h4>Order Details</h4>
      <p><strong>Customer:</strong> ${order.customerName}</p>
      <p><strong>Email:</strong> ${order.customerEmail}</p>
      <p><strong>Items:</strong> ${order.items}</p>
      <p><strong>Total:</strong> Â£${order.total}</p>
      <p><strong>Status:</strong> ${order.status}</p>
      <p><strong>Payment:</strong> ${order.paymentStatus}</p>
      <p><strong>Delivery Date:</strong> ${order.deliveryDate}</p>
    `;
    showModal('Order #' + orderId, content);
  }
}

function updateOrderStatus(orderId, newStatus) {
  const orderIndex = orders.findIndex(o => o.id === orderId);
  if (orderIndex !== -1) {
    orders[orderIndex].status = newStatus;
    localStorage.setItem('adminOrders', JSON.stringify(orders));
    loadOrdersTable();
    showNotification(`Order ${orderId} status updated to ${newStatus}`, 'success');
  }
}

function deleteOrder(orderId) {
  if (confirm('Are you sure you want to delete this order?')) {
    orders = orders.filter(o => o.id !== orderId);
    localStorage.setItem('adminOrders', JSON.stringify(orders));
    loadOrdersTable();
    showNotification('Order deleted successfully', 'success');
  }
}

function sendPushNotification() {
  const type = document.getElementById('notificationType').value;
  const message = document.getElementById('notificationMessage').value;
  
  if (message.trim()) {
    // In a real app, this would send to your notification service
    showNotification('Push notification sent to all app users!', 'success');
    document.getElementById('notificationMessage').value = '';
  } else {
    showNotification('Please enter a message', 'error');
  }
}

function testDiscordWebhook() {
  const webhookUrl = document.getElementById('discordWebhook').value;
  
  fetch(webhookUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      content: 'ğŸ§ª Test from Advanced Admin Dashboard - All systems operational! ğŸ§',
      username: 'Cupcakes Admin Pro',
      avatar_url: 'https://cdn.discordapp.com/emojis/1028516711491154031.webp'
    })
  })
  .then(response => {
    if (response.ok) {
      showNotification('Discord webhook test successful!', 'success');
    } else {
      showNotification('Discord webhook test failed', 'error');
    }
  })
  .catch(error => {
    showNotification('Discord webhook error: ' + error.message, 'error');
  });
}

// Add more functions as needed for all the features...
function filterOrders() {
  const search = document.getElementById('orderSearch').value.toLowerCase();
  const filter = document.getElementById('orderFilter').value;
  
  const rows = document.querySelectorAll('#ordersTableBody tr');
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    const status = row.querySelector('.status-badge').textContent.toLowerCase();
    
    const matchesSearch = text.includes(search);
    const matchesFilter = !filter || status.includes(filter);
    
    row.style.display = matchesSearch && matchesFilter ? '' : 'none';
  });
}

function filterCustomers() {
  const search = document.getElementById('customerSearch').value.toLowerCase();
  
  const rows = document.querySelectorAll('#customersTableBody tr');
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(search) ? '' : 'none';
  });
}

// Calendar functions
function prevMonth() {
  currentDate.setMonth(currentDate.getMonth() - 1);
  generateCalendar();
}

function nextMonth() {
  currentDate.setMonth(currentDate.getMonth() + 1);
  generateCalendar();
}

function showDayDetails(dateStr) {
  const dayOrders = orders.filter(o => o.deliveryDate === dateStr);
  let content = `<h4>Orders for ${dateStr}</h4>`;
  
  if (dayOrders.length > 0) {
    content += '<ul>';
    dayOrders.forEach(order => {
      const deliveryMethod = order.deliveryMethod || 'delivery';
      const methodIcon = deliveryMethod === 'delivery' ? 'ğŸšš' : 'ğŸª';
      const methodText = deliveryMethod === 'delivery' ? 'Delivery' : 'Market Collection';
      content += `<li><strong>${order.customerName}</strong><br>
                      ${order.items}<br>
                      <span style="color: #667eea;">${methodIcon} ${methodText} - Â£${order.total}</span></li>`;
    });
    content += '</ul>';
  } else {
    content += '<p>No orders for this date.</p>';
  }
  
  // Add day-specific info
  const dayOfWeek = new Date(dateStr).getDay();
  if (dayOfWeek === 6) { // Saturday
    content += '<hr><p style="color: #667eea; font-weight: bold;">ğŸ“ Saturday: Market Collection Available (8 AM - 2 PM)</p>';
  } else if (dayOfWeek >= 1 && dayOfWeek <= 5) { // Monday-Friday
    content += '<hr><p style="color: #667eea; font-weight: bold;">ğŸšš Weekday: Home Delivery Available</p>';
  } else { // Sunday
    content += '<hr><p style="color: #999;">ğŸ“… Sunday: No services available</p>';
  }
  
  showModal('Day Details', content);
}

// Calendar Sync Functions
function syncCalendarWithOrders() {
  // Sync admin calendar with shop orders from localStorage
  const shopOrders = JSON.parse(localStorage.getItem('shopOrders') || '[]');
  const webOrders = JSON.parse(localStorage.getItem('webOrders') || '[]');
  
  // Merge shop and web orders into admin system
  shopOrders.forEach(shopOrder => {
    const existingOrder = orders.find(o => o.id === shopOrder.id);
    if (!existingOrder) {
      orders.push({
        id: shopOrder.id || `WEB-${Date.now()}`,
        customerName: shopOrder.name,
        customerEmail: shopOrder.email,
        customerPhone: shopOrder.mobile,
        customerAddress: shopOrder.address,
        deliveryMethod: shopOrder.deliveryMethod || 'delivery',
        deliveryFee: shopOrder.deliveryFee || 0,
        items: shopOrder.items.map(item => `${item.name} x${item.quantity}`).join(', '),
        subtotal: shopOrder.subtotal ? shopOrder.subtotal.toFixed(2) : (shopOrder.total - (shopOrder.deliveryFee || 0)).toFixed(2),
        total: shopOrder.total.toFixed(2),
        status: 'pending',
        paymentStatus: 'unpaid',
        deliveryDate: shopOrder.deliveryDate || getTomorrowDate(),
        date: new Date().toISOString().split('T')[0],
        deposit: (shopOrder.total * 0.25).toFixed(2),
        remaining: (shopOrder.total * 0.75).toFixed(2),
        notes: shopOrder.notes || '',
        source: 'website'
      });
      
      // Add customer if new
      addCustomerFromOrder(shopOrder);
    }
  });
  
  // Save updated orders
  localStorage.setItem('adminOrders', JSON.stringify(orders));
  generateCalendar();
  loadOrdersTable();
  showNotification('Calendar synced with website orders!', 'success');
}

function getTomorrowDate() {
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 7); // 7 days minimum lead time
  return tomorrow.toISOString().split('T')[0];
}

// Customer Management Functions
function addCustomerFromOrder(orderData) {
  const existingCustomer = customers.find(c => c.email === orderData.email);
  
  if (!existingCustomer) {
    const newCustomer = {
      name: orderData.name,
      email: orderData.email,
      phone: orderData.mobile || '',
      address: orderData.address || '',
      joinDate: new Date().toISOString().split('T')[0],
      loyaltyPoints: 10, // Welcome points
      notes: '',
      preferences: [],
      communicationHistory: [],
      lastContact: null
    };
    
    customers.push(newCustomer);
    localStorage.setItem('adminCustomers', JSON.stringify(customers));
    updateCustomerDropdown();
    showNotification(`New customer added: ${newCustomer.name}`, 'success');
  }
}

function updateCustomerDropdown() {
  const dropdown = document.getElementById('individualCustomer');
  if (dropdown) {
    dropdown.innerHTML = '<option value="">Choose a customer...</option>';
    customers.forEach(customer => {
      const option = document.createElement('option');
      option.value = customer.email;
      option.textContent = `${customer.name} - ${customer.email}`;
      dropdown.appendChild(option);
    });
  }
}

// Individual Customer Communication
function contactIndividualCustomer() {
  const customerEmail = document.getElementById('individualCustomer').value;
  const method = document.getElementById('contactMethod').value;
  const message = document.getElementById('individualMessage').value;
  
  if (!customerEmail || !message.trim()) {
    showNotification('Please select a customer and enter a message', 'error');
    return;
  }
  
  const customer = customers.find(c => c.email === customerEmail);
  if (!customer) {
    showNotification('Customer not found', 'error');
    return;
  }
  
  // Record communication
  const communication = {
    date: new Date().toISOString(),
    customer: customer.name,
    email: customerEmail,
    method: method,
    message: message,
    status: 'sent',
    sentBy: currentUser.username
  };
  
  // Add to customer's communication history
  if (!customer.communicationHistory) {
    customer.communicationHistory = [];
  }
  customer.communicationHistory.push(communication);
  customer.lastContact = new Date().toISOString().split('T')[0];
  
  // Add to global communication history
  let commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
  commHistory.unshift(communication);
  localStorage.setItem('communicationHistory', JSON.stringify(commHistory));
  
  // Save updated customer data
  localStorage.setItem('adminCustomers', JSON.stringify(customers));
  
  // Send notification based on method
  switch(method) {
    case 'push':
      sendPushToCustomer(customer, message);
      break;
    case 'email':
      sendEmailToCustomer(customer, message);
      break;
    case 'sms':
      sendSMSToCustomer(customer, message);
      break;
    case 'call':
      initiatePhoneCall(customer, message);
      break;
  }
  
  // Clear form and update history
  document.getElementById('individualMessage').value = '';
  loadCommunicationHistory();
  showNotification(`${method.toUpperCase()} sent to ${customer.name}`, 'success');
}

function sendPushToCustomer(customer, message) {
  // In a real app, this would send a targeted push notification
  console.log(`Push notification to ${customer.email}:`, message);
  
  // Simulate sending to their browser if they have the PWA installed
  if ('serviceWorker' in navigator && 'PushManager' in window) {
    // This would be handled by your service worker and push service
    showNotification(`Push notification queued for ${customer.name}`, 'info');
  }
}

function sendEmailToCustomer(customer, message) {
  // In a real app, this would integrate with your email service
  console.log(`Email to ${customer.email}:`, message);
  showNotification(`Email queued for ${customer.name}`, 'info');
}

function sendSMSToCustomer(customer, message) {
  // In a real app, this would integrate with SMS service like Twilio
  console.log(`SMS to ${customer.phone}:`, message);
  showNotification(`SMS queued for ${customer.name}`, 'info');
}

function initiatePhoneCall(customer, message) {
  // Open phone dialer with customer's number
  if (customer.phone) {
    window.open(`tel:${customer.phone}`);
    showNotification(`Call initiated to ${customer.name} (${customer.phone})`, 'info');
  } else {
    showNotification('No phone number on file for this customer', 'error');
  }
}

function viewCustomerHistory() {
  const customerEmail = document.getElementById('individualCustomer').value;
  if (!customerEmail) {
    showNotification('Please select a customer first', 'error');
    return;
  }
  
  const customer = customers.find(c => c.email === customerEmail);
  if (!customer) {
    showNotification('Customer not found', 'error');
    return;
  }
  
  const customerOrders = orders.filter(o => o.customerEmail === customerEmail);
  const commHistory = customer.communicationHistory || [];
  
  let content = `
    <h4>Customer Profile: ${customer.name}</h4>
    <p><strong>Email:</strong> ${customer.email}</p>
    <p><strong>Phone:</strong> ${customer.phone || 'Not provided'}</p>
    <p><strong>Address:</strong> ${customer.address || 'Not provided'}</p>
    <p><strong>Join Date:</strong> ${customer.joinDate}</p>
    <p><strong>Loyalty Points:</strong> ${customer.loyaltyPoints || 0}</p>
    <p><strong>Total Orders:</strong> ${customerOrders.length}</p>
    <p><strong>Total Spent:</strong> Â£${customerOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0).toFixed(2)}</p>
    
    <h5 style="margin-top: 20px;">Recent Orders</h5>
    <ul>
  `;
  
  customerOrders.slice(0, 5).forEach(order => {
    content += `<li>${order.date} - ${order.items} (Â£${order.total}) - ${order.status}</li>`;
  });
  
  content += `</ul><h5 style="margin-top: 20px;">Communication History</h5><ul>`;
  
  commHistory.slice(0, 10).forEach(comm => {
    const date = new Date(comm.date).toLocaleDateString();
    content += `<li>${date} - ${comm.method.toUpperCase()}: ${comm.message}</li>`;
  });
  
  content += '</ul>';
  showModal('Customer History', content);
}

function loadCommunicationHistory() {
  const commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
  const tbody = document.getElementById('communicationHistory');
  
  if (tbody) {
    tbody.innerHTML = '';
    commHistory.slice(0, 20).forEach(comm => {
      const row = document.createElement('tr');
      const date = new Date(comm.date).toLocaleDateString();
      row.innerHTML = `
        <td>${date}</td>
        <td>${comm.customer}</td>
        <td><span class="status-badge status-${comm.method}">${comm.method.toUpperCase()}</span></td>
        <td>${comm.message.length > 50 ? comm.message.substring(0, 50) + '...' : comm.message}</td>
        <td><span class="status-badge status-${comm.status}">${comm.status}</span></td>
      `;
      tbody.appendChild(row);
    });
  }
}

// Enhanced Data Sync Functions
function exportCustomerData() {
  const data = {
    customers: customers,
    orders: orders,
    communicationHistory: JSON.parse(localStorage.getItem('communicationHistory') || '[]'),
    exportDate: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `customer-data-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  
  showNotification('Customer data exported successfully!', 'success');
}

function importWebOrderData() {
  // This function would be called periodically or manually to sync with web orders
  syncCalendarWithOrders();
}

// Enhanced order functions with delivery date
function addOrder() {
  const content = `
    <h4>Add New Order</h4>
    <form id="newOrderForm">
      <div class="form-group">
        <label>Customer Name</label>
        <input type="text" class="form-control" id="newOrderName" required>
      </div>
      <div class="form-group">
        <label>Customer Email</label>
        <input type="email" class="form-control" id="newOrderEmail" required>
      </div>
      <div class="form-group">
        <label>Customer Phone</label>
        <input type="tel" class="form-control" id="newOrderPhone">
      </div>
      <div class="form-group">
        <label>Items</label>
        <textarea class="form-control" id="newOrderItems" rows="3" placeholder="List items ordered..." required></textarea>
      </div>
      <div class="form-group">
        <label>Total Amount (Â£)</label>
        <input type="number" class="form-control" id="newOrderTotal" step="0.01" required>
      </div>
      <div class="form-group">
        <label>Delivery Date</label>
        <input type="date" class="form-control" id="newOrderDeliveryDate" required min="${getTomorrowDate()}">
      </div>
      <div class="form-group">
        <label>Notes</label>
        <textarea class="form-control" id="newOrderNotes" rows="2" placeholder="Special instructions..."></textarea>
      </div>
      <button type="submit" class="action-btn btn-success">Add Order</button>
    </form>
  `;
  
  showModal('Add New Order', content);
  
  // Add form submission handler
  document.getElementById('newOrderForm').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const newOrder = {
      id: `ADM-${Date.now()}`,
      customerName: document.getElementById('newOrderName').value,
      customerEmail: document.getElementById('newOrderEmail').value,
      customerPhone: document.getElementById('newOrderPhone').value,
      items: document.getElementById('newOrderItems').value,
      total: document.getElementById('newOrderTotal').value,
      status: 'pending',
      paymentStatus: 'unpaid',
      deliveryDate: document.getElementById('newOrderDeliveryDate').value,
      date: new Date().toISOString().split('T')[0],
      deposit: (parseFloat(document.getElementById('newOrderTotal').value) * 0.25).toFixed(2),
      remaining: (parseFloat(document.getElementById('newOrderTotal').value) * 0.75).toFixed(2),
      notes: document.getElementById('newOrderNotes').value,
      source: 'admin'
    };
    
    orders.push(newOrder);
    localStorage.setItem('adminOrders', JSON.stringify(orders));
    
    // Add customer if new
    addCustomerFromOrder({
      name: newOrder.customerName,
      email: newOrder.customerEmail,
      mobile: newOrder.customerPhone
    });
    
    loadOrdersTable();
    generateCalendar();
    closeModal();
    showNotification('Order added successfully!', 'success');
  });
}

// Initialize enhanced functions when dashboard loads
function initializeEnhancedFeatures() {
  updateCustomerDropdown();
  loadCommunicationHistory();
  
  // Auto-sync with web orders every 30 seconds
  setInterval(() => {
    if (currentUser && document.getElementById('dashboard').style.display === 'block') {
      importWebOrderData();
    }
  }, 30000);
}

// Close modal when clicking outside
window.addEventListener('click', (e) => {
  const modal = document.getElementById('modal');
  if (e.target === modal) {
    closeModal();
  }
});

// Auto-refresh every 5 minutes
setInterval(() => {
  if (currentUser && document.getElementById('dashboard').style.display === 'block') {
    refreshAllData();
    checkUpcomingOrdersForNotifications();
  }
}, 300000);

// Automatic notification system for upcoming orders
function checkUpcomingOrdersForNotifications() {
  const today = new Date();
  
  orders.forEach(order => {
    const deliveryDate = new Date(order.deliveryDate);
    const daysUntil = Math.ceil((deliveryDate - today) / (1000 * 60 * 60 * 24));
    
    // Send 3-day reminder if not already sent
    if (daysUntil === 3 && !order.reminderSent && order.status !== 'completed' && order.status !== 'cancelled') {
      sendAutomaticReminder(order);
      order.reminderSent = true;
      localStorage.setItem('adminOrders', JSON.stringify(orders));
    }
  });
}

function sendAutomaticReminder(order) {
  const deliveryMethod = order.deliveryMethod || 'delivery';
  const methodText = deliveryMethod === 'delivery' ? 'delivery' : 'collection from Highworth Market';
  
  const message = `Hi ${order.customerName}! Your order #${order.id} is scheduled for ${methodText} in 3 days (${order.deliveryDate}). Any last minute changes? Please contact us soon! ğŸ§`;
  
  // Send push notification to customer
  sendPushToCustomer({
    name: order.customerName,
    email: order.customerEmail,
    phone: order.customerPhone
  }, message);
  
  // Log in communication history
  const communication = {
    date: new Date().toISOString(),
    customer: order.customerName,
    email: order.customerEmail,
    method: 'automatic-push',
    message: message,
    status: 'sent',
    sentBy: 'system',
    orderId: order.id
  };
  
  let commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
  commHistory.unshift(communication);
  localStorage.setItem('communicationHistory', JSON.stringify(commHistory));
  
  // Show admin notification
  showNotification(`ğŸ“± Automatic reminder sent to ${order.customerName} for order #${order.id}`, 'success');
  
  // Send Discord notification to admin
  const webhookUrl = document.getElementById('discordWebhook')?.value;
  if (webhookUrl) {
    fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: `ğŸ”” **Automatic Reminder Sent**\nğŸ“‹ Order: #${order.id}\nğŸ‘¤ Customer: ${order.customerName}\nğŸ“… ${methodText.charAt(0).toUpperCase() + methodText.slice(1)} in 3 days\nğŸ’¬ Message: "${message}"`,
        username: 'Order Reminder Bot',
        avatar_url: 'https://cdn.discordapp.com/emojis/1028516711491154031.webp'
      })
    });
  }
}

// Manual reminder function for admin use
function sendManualReminder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;
  
  const deliveryMethod = order.deliveryMethod || 'delivery';
  const methodText = deliveryMethod === 'delivery' ? 'delivery' : 'collection from Highworth Market';
  
  const content = `
    <h4>Send Reminder for Order #${orderId}</h4>
    <p><strong>Customer:</strong> ${order.customerName}</p>
    <p><strong>Scheduled:</strong> ${methodText} on ${order.deliveryDate}</p>
    
    <form id="reminderForm">
      <div class="form-group">
        <label>Reminder Message</label>
        <textarea class="form-control" id="reminderMessage" rows="4">Hi ${order.customerName}! Your order #${order.id} is scheduled for ${methodText} on ${order.deliveryDate}. Any last minute changes? Please let us know! ğŸ§</textarea>
      </div>
      
      <div class="form-group">
        <label>Send Method</label>
        <select class="form-control" id="reminderMethod">
          <option value="push">Push Notification</option>
          <option value="email">Email</option>
          <option value="sms">SMS</option>
        </select>
      </div>
      
      <button type="submit" class="action-btn btn-primary">ğŸ“¤ Send Reminder</button>
    </form>
  `;
  
  showModal('Send Order Reminder', content);
  
  document.getElementById('reminderForm').addEventListener('submit', (e) => {
    e.preventDefault();
    
    const message = document.getElementById('reminderMessage').value;
    const method = document.getElementById('reminderMethod').value;
    
    // Send the reminder
    const customer = {
      name: order.customerName,
      email: order.customerEmail,
      phone: order.customerPhone
    };
    
    switch(method) {
      case 'push':
        sendPushToCustomer(customer, message);
        break;
      case 'email':
        sendEmailToCustomer(customer, message);
        break;
      case 'sms':
        sendSMSToCustomer(customer, message);
        break;
    }
    
    // Log the communication
    const communication = {
      date: new Date().toISOString(),
      customer: order.customerName,
      email: order.customerEmail,
      method: method,
      message: message,
      status: 'sent',
      sentBy: currentUser.username,
      orderId: order.id
    };
    
    let commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
    commHistory.unshift(communication);
    localStorage.setItem('communicationHistory', JSON.stringify(commHistory));
    
    loadCommunicationHistory();
    closeModal();
    showNotification(`Reminder sent via ${method.toUpperCase()} to ${order.customerName}`, 'success');
  });
}

// Check for upcoming orders every hour
setInterval(checkUpcomingOrdersForNotifications, 60 * 60 * 1000);

// Initialize enhanced features on dashboard load
document.addEventListener('DOMContentLoaded', () => {
  // Add enhanced initialization when tab switches to communications
  const originalSwitchTab = switchTab;
  window.switchTab = function(tabName) {
    originalSwitchTab(tabName);
    if (tabName === 'communications') {
      updateCustomerDropdown();
      loadCommunicationHistory();
    }
  };
  
  // Run initial check for upcoming orders
  setTimeout(() => {
    if (currentUser) {
      checkUpcomingOrdersForNotifications();
    }
  }, 5000);
});
</script>

</body>
</html>