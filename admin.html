<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<title>Cupcakes on the Avenue Admin Dashboard</title>
<link rel="icon" type="image/x-icon" href="pictures/favicon.ico">

<!-- PWA Meta Tags -->
<meta name="description" content="Professional admin dashboard for Cupcakes on the Avenue - manage orders, customers, inventory, and communications">
<meta name="keywords" content="admin, dashboard, bakery, cupcakes, management">
<meta name="author" content="Cupcakes on the Avenue">
<meta name="theme-color" content="#667eea">
<meta name="msapplication-TileColor" content="#667eea">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="COTA Admin">
<meta name="mobile-web-app-capable" content="yes">
<meta name="application-name" content="Cupcakes on the Avenue Admin">

<!-- PWA Manifest -->
<link rel="manifest" href="admin-manifest.json">

<!-- Apple Touch Icons -->
<link rel="apple-touch-icon" href="pictures/logo.png">

<!-- Microsoft Tiles -->
<meta name="msapplication-TileImage" content="pictures/logo.png">
<meta name="msapplication-config" content="browserconfig.xml">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  color: #333;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  /* PWA enhancements */
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  /* Safe area for notched devices */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* Login Screen */
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.login-box {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  max-width: 400px;
  width: 100%;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.login-box h1 {
  color: #667eea;
  margin-bottom: 30px;
  font-size: 2rem;
}

.login-box input {
  width: 100%;
  padding: 15px;
  margin: 10px 0;
  border: 2px solid rgba(102, 126, 234, 0.2);
  border-radius: 10px;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.8);
}

.login-box input:focus {
  border-color: #667eea;
  outline: none;
  background: white;
}

.login-btn {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  transition: transform 0.2s ease;
}

.login-btn:hover {
  transform: translateY(-2px);
}

.error-message {
  color: #dc3545;
  margin-top: 10px;
  font-size: 0.9rem;
}

/* Dashboard */
.dashboard {
  display: none;
  padding: 20px;
  max-width: 1600px;
  margin: 0 auto;
}

.dashboard-header {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  margin-bottom: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.dashboard-header h1 {
  color: #667eea;
  font-size: 2.5rem;
}

.header-controls {
  display: flex;
  gap: 15px;
  align-items: center;
}

.logout-btn, .refresh-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.refresh-btn {
  background: #28a745;
}

.logout-btn:hover, .refresh-btn:hover {
  transform: translateY(-2px);
}

/* Navigation Tabs */
.nav-tabs {
  display: flex;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 10px;
  margin-bottom: 30px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  overflow-x: auto;
  gap: 5px;
  flex-wrap: nowrap;
  -webkit-overflow-scrolling: touch;
}

.nav-tabs::-webkit-scrollbar {
  height: 4px;
}

.nav-tabs::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 2px;
}

.nav-tabs::-webkit-scrollbar-thumb {
  background: #667eea;
  border-radius: 2px;
}

.nav-tab {
  background: transparent;
  border: none;
  padding: 12px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  color: #667eea;
  transition: all 0.3s ease;
  white-space: nowrap;
  min-width: fit-content;
}

.nav-tab.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  transform: translateY(-2px);
}

.nav-tab:hover:not(.active) {
  background: rgba(102, 126, 234, 0.1);
}

/* Tab Content */
.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Dashboard Cards */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-bottom: 30px;
}

.dashboard-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: transform 0.3s ease;
}

.dashboard-card:hover {
  transform: translateY(-5px);
}

.dashboard-card h2 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.stat-item:last-child {
  border-bottom: none;
}

.stat-value {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
}

/* Charts */
.chart-container {
  position: relative;
  height: 300px;
  margin-top: 20px;
}

/* Tables */
.table-container {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  overflow-x: auto;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.data-table th,
.data-table td {
  padding: 15px;
  text-align: left;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.data-table th {
  background: rgba(102, 126, 234, 0.1);
  font-weight: bold;
  color: #667eea;
  position: sticky;
  top: 0;
}

.activity-item {
  border-left: 4px solid #667eea;
  padding: 12px;
  margin-bottom: 10px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
}

.activity-item:hover {
  transform: translateX(5px);
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.stat-label {
  font-weight: 500;
  color: #666;
}

.stat-value {
  font-weight: bold;
  color: #667eea;
  font-size: 1.2em;
}

.user-info {
  display: flex;
  align-items: center;
  margin-right: 15px;
  padding: 8px 15px;
  background: rgba(255,255,255,0.1);
  border-radius: 20px;
  font-size: 14px;
  color: white;
}

.data-table tr:hover {
  background: rgba(102, 126, 234, 0.05);
}

/* Status Badges */
.status-badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: bold;
  text-transform: uppercase;
}

.status-pending { background: #fff3cd; color: #856404; }
.status-confirmed { background: #d4edda; color: #155724; }
.status-completed { background: #cce5ff; color: #004085; }
.status-cancelled { background: #f8d7da; color: #721c24; }
.status-paid { background: #d1ecf1; color: #0c5460; }
.status-unpaid { background: #ffeaa7; color: #856404; }

/* Action Buttons */
.action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: bold;
  margin: 2px;
  transition: all 0.2s ease;
}

.btn-primary { background: #007bff; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: #212529; }
.btn-danger { background: #dc3545; color: white; }
.btn-info { background: #17a2b8; color: white; }

.action-btn:hover {
  transform: translateY(-1px);
  opacity: 0.9;
}

/* Forms */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #555;
}

.form-control {
  width: 100%;
  padding: 12px;
  border: 2px solid rgba(102, 126, 234, 0.2);
  border-radius: 8px;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.8);
}

.form-control:focus {
  border-color: #667eea;
  outline: none;
  background: white;
}

/* Calendar */
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
}

.calendar-header {
  background: #667eea;
  color: white;
  padding: 10px;
  text-align: center;
  font-weight: bold;
}

.calendar-day {
  background: white;
  padding: 10px;
  min-height: 60px;
  border: 1px solid #eee;
  position: relative;
  cursor: pointer;
}

.calendar-day:hover {
  background: #f8f9fa;
}

.calendar-day.has-orders {
  background: rgba(102, 126, 234, 0.1);
}

.calendar-day.blocked {
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
}

.order-dot {
  width: 8px;
  height: 8px;
  background: #667eea;
  border-radius: 50%;
  position: absolute;
  top: 5px;
  right: 5px;
}

/* Notifications */
.notification-panel {
  position: fixed;
  top: 20px;
  right: 20px;
  max-width: 350px;
  z-index: 1000;
}

.notification {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-left: 4px solid #667eea;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  animation: slideIn 0.3s ease;
}

.notification.success { border-left-color: #28a745; }
.notification.warning { border-left-color: #ffc107; }
.notification.error { border-left-color: #dc3545; }

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 20px;
  max-width: 600px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.close-modal {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #999;
}

.close-modal:hover {
  color: #333;
}

/* Debug & Fallback Styles */
.status-indicator {
  display: flex;
  align-items: center;
  margin: 8px 0;
  padding: 8px;
  background: #f8f9fa;
  border-radius: 6px;
}

.status-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 10px;
  display: inline-block;
}

.status-checking {
  background: #ffc107;
  animation: pulse 1.5s infinite;
}

.status-online {
  background: #28a745;
}

.status-offline {
  background: #dc3545;
}

.status-warning {
  background: #fd7e14;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

.status-badge {
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
  text-transform: uppercase;
}

.status-active {
  background: #d4edda;
  color: #155724;
}

.status-inactive {
  background: #f8d7da;
  color: #721c24;
}

.fallback-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #eee;
}

.fallback-item:last-child {
  border-bottom: none;
}

.pending-email-item {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  padding: 12px;
  margin: 8px 0;
}

.pending-email-header {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 8px;
}

.pending-email-type {
  background: #007bff;
  color: white;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.7rem;
  text-transform: uppercase;
}

.pending-email-time {
  font-size: 0.8rem;
  color: #666;
}

.pending-email-preview {
  font-size: 0.9rem;
  color: #333;
  margin-top: 5px;
}

.emergency-controls {
  border: 2px solid #dc3545;
  border-radius: 8px;
  padding: 15px;
  background: #fff5f5;
}

.notification-item {
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #eee;
  background: white;
  border-radius: 4px;
  margin: 5px 0;
}

.notification-item.unread {
  background: #e3f2fd;
  border-left: 3px solid #2196f3;
}

.notification-icon {
  width: 20px;
  height: 20px;
  margin-right: 10px;
  font-size: 16px;
}

.notification-content {
  flex: 1;
}

.notification-time {
  font-size: 0.8rem;
  color: #666;
}

/* PWA Enhancements */
.pwa-install-banner {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px;
  text-align: center;
  transform: translateY(100%);
  transition: transform 0.3s ease;
  z-index: 10000;
  box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
}

.pwa-install-banner.show {
  transform: translateY(0);
}

.pwa-install-banner button {
  background: white;
  color: #667eea;
  border: none;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: bold;
  margin: 0 5px;
  cursor: pointer;
  touch-action: manipulation;
}

.pwa-install-banner button:hover {
  background: #f8f9fa;
}

/* Touch-friendly enhancements */
button, .action-btn, .nav-tab {
  min-height: 44px;
  min-width: 44px;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
}

/* App-like loading screen */
.app-loading {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10001;
  color: white;
  transition: opacity 0.5s ease;
}

.app-loading.hidden {
  opacity: 0;
  pointer-events: none;
}

.app-logo {
  font-size: 4rem;
  margin-bottom: 20px;
  animation: pulse 2s infinite;
}

.app-name {
  font-size: 1.5rem;
  font-weight: bold;
  margin-bottom: 10px;
}

.app-tagline {
  font-size: 1rem;
  opacity: 0.8;
  margin-bottom: 30px;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255,255,255,0.3);
  border-top: 3px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Connection status indicator */
.connection-status {
  position: fixed;
  top: env(safe-area-inset-top, 10px);
  right: env(safe-area-inset-right, 10px);
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 0.8rem;
  z-index: 9999;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.connection-status.online {
  background: rgba(40, 167, 69, 0.9);
}

.connection-status.offline {
  background: rgba(220, 53, 69, 0.9);
}

/* Pull-to-refresh indicator */
.pull-to-refresh {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  background: rgba(255,255,255,0.9);
  padding: 10px 20px;
  border-radius: 0 0 15px 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
  z-index: 9998;
}

.pull-to-refresh.show {
  transform: translateX(-50%) translateY(0);
}

/* App update banner */
.app-update-banner {
  position: fixed;
  top: env(safe-area-inset-top, 0);
  left: 0;
  right: 0;
  background: #ffc107;
  color: #333;
  padding: 10px;
  text-align: center;
  font-size: 0.9rem;
  z-index: 9997;
  transform: translateY(-100%);
  transition: transform 0.3s ease;
}

.app-update-banner.show {
  transform: translateY(0);
}

.app-update-banner button {
  background: #333;
  color: white;
  border: none;
  padding: 5px 15px;
  border-radius: 15px;
  margin-left: 10px;
  cursor: pointer;
}

/* Mobile Navigation Sidebar */
.mobile-nav-toggle {
  display: none;
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1002;
  background: #667eea;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.nav-sidebar {
  position: fixed;
  top: 0;
  left: -300px;
  width: 280px;
  height: 100vh;
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(10px);
  z-index: 1001;
  transition: left 0.3s ease;
  overflow-y: auto;
  border-right: 1px solid rgba(102, 126, 234, 0.2);
  box-shadow: 4px 0 20px rgba(0,0,0,0.1);
}

.nav-sidebar.open {
  left: 0;
}

.nav-sidebar-header {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  text-align: center;
}

.nav-sidebar-header h3 {
  margin: 0;
  font-size: 1.2rem;
}

.nav-sidebar-menu {
  padding: 20px 0;
}

.nav-sidebar-item {
  display: block;
  width: 100%;
  padding: 15px 25px;
  border: none;
  background: none;
  text-align: left;
  color: #333;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  border-bottom: 1px solid rgba(240, 240, 240, 0.5);
}

.nav-sidebar-item:hover {
  background: rgba(102, 126, 234, 0.1);
  color: #667eea;
}

.nav-sidebar-item.active {
  background: #667eea;
  color: white;
}

.nav-sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.3);
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
}

.nav-sidebar-overlay.show {
  opacity: 1;
  visibility: visible;
}

/* Responsive */
@media (max-width: 768px) {
  .nav-tabs {
    display: none;
  }
  
  .mobile-nav-toggle {
    display: block;
  }
  
  .dashboard {
    padding: 80px 10px 10px 10px;
  }
  
  .dashboard-header {
    padding: 15px;
    margin-bottom: 20px;
  }
  
  .dashboard-header h1 {
    font-size: 1.5rem;
    margin: 0;
  }
  
  .header-controls {
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }
  
  .user-info {
    font-size: 12px;
    padding: 6px 12px;
    margin: 0;
  }
}

/* App Loading Screen */
div class="app-loading" id="appLoading">
  <div class="app-logo"><img src="pictures/logo.png" alt="Cupcakes on the Avenue" style="width: 80px; height: 80px; border-radius: 50%;"></div>
  <div class="app-name">Cupcakes on the Avenue</div>
  <div class="app-tagline">Admin Dashboard</div>
  <div class="loading-spinner"></div>
</div>

<!-- Connection Status -->
<div class="connection-status online" id="connectionStatus">
  ğŸŸ¢ Online
</div>

<!-- App Update Banner -->
<div class="app-update-banner" id="appUpdateBanner">
  ğŸ“± A new version is available! 
  <button onclick="updateApp()">Update</button>
  <button onclick="dismissUpdate()">Later</button>
</div>

<!-- Pull to Refresh -->
<div class="pull-to-refresh" id="pullToRefresh">
  ğŸ”„ Release to refresh
</div>

<!-- PWA Install Banner -->
<div class="pwa-install-banner" id="installBanner">
  ğŸ“± Install Cupcakes on the Avenue Admin for the best experience!
  <br>
  <button onclick="installApp()">Install App</button>
  <button onclick="dismissInstall()">Not Now</button>
</div>

<!-- Mobile Navigation -->
<button class="mobile-nav-toggle" id="mobileNavToggle">â˜°</button>

<!-- Navigation Sidebar -->
<div class="nav-sidebar-overlay" id="navSidebarOverlay"></div>
<div class="nav-sidebar" id="navSidebar">
  <div class="nav-sidebar-header">
    <h3>ğŸ§ Admin Menu</h3>
  </div>
  <div class="nav-sidebar-menu">
    <button class="nav-sidebar-item active" data-tab="overview">ğŸ“Š Overview</button>
    <button class="nav-sidebar-item" data-tab="orders">ğŸ“‹ Orders</button>
    <button class="nav-sidebar-item" data-tab="customers">ğŸ‘¥ Customers</button>
    <button class="nav-sidebar-item" data-tab="calendar">ğŸ“… Calendar</button>
    <button class="nav-sidebar-item" data-tab="analytics">ğŸ“ˆ Analytics</button>
    <button class="nav-sidebar-item" data-tab="inventory">ğŸ“¦ Inventory</button>
    <button class="nav-sidebar-item" data-tab="finances">ğŸ’° Finances</button>
    <button class="nav-sidebar-item" data-tab="communications">ğŸ“± Communications</button>
    <button class="nav-sidebar-item" data-tab="activity">ğŸ‘ï¸ Activity Log</button>
    <button class="nav-sidebar-item" data-tab="debug">ğŸ”§ Debug & Fallbacks</button>
    <button class="nav-sidebar-item" data-tab="settings">âš™ï¸ Settings</button>
  </div>
</div>

<!-- Login Screen -->
<div class="login-container" id="loginContainer">
  <div class="login-box">
    <div id="loginView">
      <h1>ğŸ” Admin Login</h1>
      <p style="color: #666; margin-bottom: 30px;">Access the comprehensive admin dashboard</p>
      <form id="loginForm">
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit" class="login-btn">Login</button>
        <div class="error-message" id="errorMessage"></div>
      </form>
      <p style="text-align: center; margin-top: 20px; color: #666;">
        Don't have an account? 
        <a href="#" onclick="showSignup()" style="color: #667eea; text-decoration: none;">Sign up here</a>
      </p>
    </div>

    <div id="signupView" style="display: none;">
      <h1>ğŸ‘¤ Create Admin Account</h1>
      <p style="color: #666; margin-bottom: 30px;">Join the admin team</p>
      <form id="signupForm">
        <input type="text" id="signupFullName" placeholder="Full Name" required>
        <input type="text" id="signupUsername" placeholder="Username" required>
        <input type="email" id="signupEmail" placeholder="Email" required>
        <input type="password" id="signupPassword" placeholder="Password" required>
        <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
        <select id="userRole" required style="margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; width: 100%; font-size: 16px;">
          <option value="">Select Role</option>
          <option value="admin">Admin (Full Access)</option>
          <option value="manager">Manager (Orders & Inventory)</option>
          <option value="staff">Staff (Orders Only)</option>
        </select>
        <button type="submit" class="login-btn">Create Account</button>
        <div class="error-message" id="signupErrorMessage"></div>
      </form>
      <p style="text-align: center; margin-top: 20px; color: #666;">
        Already have an account? 
        <a href="#" onclick="showLogin()" style="color: #667eea; text-decoration: none;">Login here</a>
      </p>
    </div>
  </div>
</div>

<!-- Notification Panel -->
<div class="notification-panel" id="notificationPanel"></div>

<!-- Dashboard -->
<div class="dashboard" id="dashboard">
  <div class="dashboard-header">
    <h1>ğŸ§ Cupcakes on the Avenue Admin</h1>
    <div class="header-controls">
      <div class="user-info" style="margin-right: 15px; padding: 8px 15px; background: rgba(255,255,255,0.1); border-radius: 20px; font-size: 14px;">
        ğŸ‘¤ <span id="currentUserName">Admin User</span> 
        <span style="opacity: 0.7;">(<span id="currentUserRole">admin</span>)</span>
      </div>
      <span id="lastUpdate">Last updated: Never</span>
      <button class="refresh-btn" id="refreshAll">ğŸ”„ Refresh</button>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="nav-tabs">
    <button class="nav-tab active" data-tab="overview">ğŸ“Š Overview</button>
    <button class="nav-tab" data-tab="orders">ğŸ“‹ Orders</button>
    <button class="nav-tab" data-tab="customers">ğŸ‘¥ Customers</button>
    <button class="nav-tab" data-tab="calendar">ğŸ“… Calendar</button>
    <button class="nav-tab" data-tab="analytics">ğŸ“ˆ Analytics</button>
    <button class="nav-tab" data-tab="inventory">ğŸ“¦ Inventory</button>
    <button class="nav-tab" data-tab="finances">ğŸ’° Finances</button>
    <button class="nav-tab" data-tab="communications">ğŸ“± Communications</button>
    <button class="nav-tab" data-tab="activity">ğŸ‘ï¸ Activity Log</button>
    <button class="nav-tab" data-tab="debug">ğŸ”§ Debug & Fallbacks</button>
    <button class="nav-tab" data-tab="settings">âš™ï¸ Settings</button>
  </div>

  <!-- Overview Tab -->
  <div class="tab-content active" id="overview">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“Š Today's Summary</h2>
        <div class="stat-item">
          <span>New Orders</span>
          <span class="stat-value" id="todayOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Revenue</span>
          <span class="stat-value" id="todayRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>Pending Orders</span>
          <span class="stat-value" id="pendingOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Customer Messages</span>
          <span class="stat-value" id="newMessages">0</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ“ˆ This Week</h2>
        <div class="stat-item">
          <span>Total Orders</span>
          <span class="stat-value" id="weekOrders">0</span>
        </div>
        <div class="stat-item">
          <span>Revenue</span>
          <span class="stat-value" id="weekRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>New Customers</span>
          <span class="stat-value" id="newCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Avg Order Value</span>
          <span class="stat-value" id="avgOrderValue">Â£0.00</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ¯ Key Metrics</h2>
        <div class="stat-item">
          <span>Total Customers</span>
          <span class="stat-value" id="totalCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Repeat Customers</span>
          <span class="stat-value" id="repeatCustomers">0</span>
        </div>
        <div class="stat-item">
          <span>Monthly Revenue</span>
          <span class="stat-value" id="monthlyRevenue">Â£0.00</span>
        </div>
        <div class="stat-item">
          <span>Outstanding Payments</span>
          <span class="stat-value" id="outstandingPayments">Â£0.00</span>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ§ Top Products</h2>
        <div id="topProducts">
          <div class="stat-item">
            <span>Shortbread Delight</span>
            <span class="stat-value">24 sold</span>
          </div>
          <div class="stat-item">
            <span>Vanilla Cupcakes</span>
            <span class="stat-value">18 sold</span>
          </div>
          <div class="stat-item">
            <span>Chocolate Brownies</span>
            <span class="stat-value">15 sold</span>
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-card">
      <h2>ğŸ“ˆ Revenue Chart (Last 7 Days)</h2>
      <div class="chart-container">
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Orders Tab -->
  <div class="tab-content" id="orders">
    <div class="table-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ“‹ Order Management</h2>
        <div>
          <button class="action-btn btn-primary" onclick="exportOrders()">ğŸ“„ Export</button>
          <button class="action-btn btn-success" onclick="addOrder()">â• Add Order</button>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <input type="text" class="form-control" placeholder="ğŸ” Search orders..." id="orderSearch" style="max-width: 300px; display: inline-block; margin-right: 10px;">
        <select class="form-control" id="orderFilter" style="max-width: 200px; display: inline-block;">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>

      <table class="data-table" id="ordersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Payment</th>
            <th>Delivery Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <!-- Orders will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Customers Tab -->
  <div class="tab-content" id="customers">
    <div class="table-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ‘¥ Customer Management</h2>
        <div>
          <button class="action-btn btn-primary" onclick="exportCustomers()">ğŸ“„ Export</button>
          <button class="action-btn btn-success" onclick="addCustomer()">â• Add Customer</button>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <input type="text" class="form-control" placeholder="ğŸ” Search customers..." id="customerSearch" style="max-width: 300px; display: inline-block;">
      </div>

      <table class="data-table" id="customersTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Total Orders</th>
            <th>Total Spent</th>
            <th>Last Order</th>
            <th>Loyalty Points</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="customersTableBody">
          <!-- Customers will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Calendar Tab -->
  <div class="tab-content" id="calendar">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“… Order Calendar</h2>
        <div style="margin-bottom: 20px;">
          <button class="action-btn btn-primary" onclick="prevMonth()">â† Previous</button>
          <span id="currentMonth" style="margin: 0 20px; font-weight: bold;"></span>
          <button class="action-btn btn-primary" onclick="nextMonth()">Next â†’</button>
        </div>
        <div class="calendar" id="orderCalendar">
          <!-- Calendar will be generated here -->
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸš« Blocked Dates</h2>
        <div style="margin-bottom: 20px;">
          <input type="date" class="form-control" id="blockDate" style="margin-bottom: 10px;">
          <button class="action-btn btn-danger" onclick="blockDate()">Block Date</button>
        </div>
        <div id="blockedDatesList">
          <!-- Blocked dates will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Tab -->
  <div class="tab-content" id="analytics">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“Š Sales Analytics</h2>
        <div class="chart-container">
          <canvas id="salesChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ§ Product Performance</h2>
        <div class="chart-container">
          <canvas id="productChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ‘¥ Customer Analytics</h2>
        <div class="chart-container">
          <canvas id="customerChart"></canvas>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“ˆ Growth Metrics</h2>
        <div class="stat-item">
          <span>Month-over-Month Growth</span>
          <span class="stat-value">+12.5%</span>
        </div>
        <div class="stat-item">
          <span>Customer Retention Rate</span>
          <span class="stat-value">68%</span>
        </div>
        <div class="stat-item">
          <span>Average Order Frequency</span>
          <span class="stat-value">2.3/month</span>
        </div>
        <div class="stat-item">
          <span>Peak Order Day</span>
          <span class="stat-value">Saturday</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Inventory Tab -->
  <div class="tab-content" id="inventory">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“¦ Stock Levels</h2>
        <div style="margin-bottom: 20px;">
          <button class="action-btn btn-success" onclick="addInventoryItem()">â• Add Item</button>
          <button class="action-btn btn-warning" onclick="generateShoppingList()">ğŸ“ Shopping List</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Current Stock</th>
              <th>Low Stock Alert</th>
              <th>Unit Cost</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="inventoryTableBody">
            <!-- Inventory items will be populated here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Finances Tab -->
  <div class="tab-content" id="finances">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ’° Financial Overview</h2>
        <div class="stat-item">
          <span>Today's Revenue</span>
          <span class="stat-value">Â£156.50</span>
        </div>
        <div class="stat-item">
          <span>This Week</span>
          <span class="stat-value">Â£892.30</span>
        </div>
        <div class="stat-item">
          <span>This Month</span>
          <span class="stat-value">Â£3,245.80</span>
        </div>
        <div class="stat-item">
          <span>Outstanding Payments</span>
          <span class="stat-value">Â£425.00</span>
        </div>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“Š Payment Tracking</h2>
        <div class="chart-container">
          <canvas id="paymentChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="table-container">
      <h2>ğŸ’³ Payment Management</h2>
      <table class="data-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Total Amount</th>
            <th>Deposit (25%)</th>
            <th>Remaining</th>
            <th>Deposit Status</th>
            <th>Final Payment</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="paymentsTableBody">
          <!-- Payment tracking will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Communications Tab -->
  <div class="tab-content" id="communications">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“± Push Notifications</h2>
        <div class="form-group">
          <label>Notification Type</label>
          <select class="form-control" id="notificationType">
            <option value="weekly-bakes">Weekly Bakes Update</option>
            <option value="new-product">New Product Launch</option>
            <option value="discount">Special Offer</option>
            <option value="market-special">Market Special</option>
            <option value="custom">Custom Message</option>
          </select>
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="notificationMessage" rows="3" placeholder="Enter your notification message..."></textarea>
        </div>
        <button class="action-btn btn-primary" onclick="sendPushNotification()">ğŸ“¤ Send to All</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ‘¤ Individual Customer Contact</h2>
        <div class="form-group">
          <label>Select Customer</label>
          <select class="form-control" id="individualCustomer">
            <option value="">Choose a customer...</option>
          </select>
        </div>
        <div class="form-group">
          <label>Contact Method</label>
          <select class="form-control" id="contactMethod">
            <option value="push">Push Notification</option>
            <option value="email">Email</option>
            <option value="sms">SMS</option>
            <option value="call">Phone Call</option>
          </select>
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="individualMessage" rows="3" placeholder="Personal message to customer..."></textarea>
        </div>
        <div class="form-group">
          <button class="action-btn btn-success" onclick="contactIndividualCustomer()">ğŸ“ Send Message</button>
          <button class="action-btn btn-info" onclick="viewCustomerHistory()">ğŸ“‹ View History</button>
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ“§ Email Campaign</h2>
        <div class="form-group">
          <label>Recipients</label>
          <select class="form-control" id="emailRecipients">
            <option value="all">All Customers</option>
            <option value="recent">Recent Customers (30 days)</option>
            <option value="loyal">Loyal Customers</option>
            <option value="inactive">Inactive Customers</option>
          </select>
        </div>
        <div class="form-group">
          <label>Subject</label>
          <input type="text" class="form-control" id="emailSubject" placeholder="Email subject...">
        </div>
        <div class="form-group">
          <label>Message</label>
          <textarea class="form-control" id="emailMessage" rows="4" placeholder="Email content..."></textarea>
        </div>
        <button class="action-btn btn-primary" onclick="sendEmailCampaign()">ğŸ“§ Send Email</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ“Š Communication History</h2>
        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Customer</th>
                <th>Method</th>
                <th>Message</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="communicationHistory">
              <!-- Communication history will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <div class="dashboard-card">
      <h2>ğŸ“± Social Media Scheduler</h2>
      <div class="form-group">
        <label>Platform</label>
        <select class="form-control" id="socialPlatform">
          <option value="instagram">Instagram</option>
          <option value="facebook">Facebook</option>
          <option value="twitter">Twitter</option>
        </select>
      </div>
      <div class="form-group">
        <label>Post Content</label>
        <textarea class="form-control" id="socialContent" rows="3" placeholder="What's happening at the bakery..."></textarea>
      </div>
      <div class="form-group">
        <label>Schedule for</label>
        <input type="datetime-local" class="form-control" id="socialSchedule">
      </div>
      <button class="action-btn btn-primary" onclick="scheduleSocialPost()">ğŸ“… Schedule Post</button>
    </div>
  </div>

  <!-- Activity Log Tab -->
  <div class="tab-content" id="activity">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>ğŸ‘ï¸ Activity Log</h2>
        <div style="margin-bottom: 20px;">
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <select id="activityFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="all">All Activities</option>
              <option value="login">Login/Logout</option>
              <option value="orders">Order Changes</option>
              <option value="customers">Customer Changes</option>
              <option value="inventory">Inventory Changes</option>
              <option value="settings">Settings Changes</option>
            </select>
            <select id="userFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="all">All Users</option>
            </select>
            <input type="date" id="dateFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <button onclick="filterActivityLog()" style="padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 4px;">Filter</button>
            <button onclick="exportActivityLog()" style="padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 4px;">ğŸ“„ Export</button>
          </div>
        </div>
        <div id="activityLogContainer" style="max-height: 500px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f8f9fa;">
          <div class="activity-log" id="activityLogList">
            <!-- Activity log entries will be populated here -->
          </div>
        </div>
      </div>

      <div class="dashboard-card">
        <h2>ğŸ“Š Activity Summary</h2>
        <div class="activity-stats">
          <div class="stat-item">
            <span class="stat-label">Total Actions Today:</span>
            <span class="stat-value" id="todayActions">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Active Users:</span>
            <span class="stat-value" id="activeUsers">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Last Activity:</span>
            <span class="stat-value" id="lastActivity">Never</span>
          </div>
        </div>
        
        <h3 style="margin-top: 20px;">ğŸ“ˆ User Activity Chart</h3>
        <div id="activityChart" style="height: 200px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
          Activity chart will appear here
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Tab -->
  <div class="tab-content" id="settings">
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>âš™ï¸ General Settings</h2>
        <div class="form-group">
          <label>Business Name</label>
          <input type="text" class="form-control" value="Cupcakes on the Avenue" id="businessName">
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="text" class="form-control" value="07842817789" id="businessPhone">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" class="form-control" value="cupcakesontheavenue@gmail.com" id="businessEmail">
        </div>
        <div class="form-group">
          <label>Minimum Lead Time (days)</label>
          <input type="number" class="form-control" value="7" id="leadTime">
        </div>
        <button class="action-btn btn-success" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
      </div>
      
      <div class="dashboard-card">
        <h2>ğŸ”” Notification Settings</h2>
        <div class="form-group">
          <label>
            <input type="checkbox" id="emailNotifications" checked> Email Notifications
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="smsNotifications" checked> SMS Notifications
          </label>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="discordNotifications" checked> Discord Notifications
          </label>
        </div>
        <div class="form-group">
          <label>Discord Webhook URL</label>
          <input type="url" class="form-control" id="discordWebhook" value="https://discord.com/api/webhooks/1426192909044023297/Ilgqgr8p7buI95ai-zssfphPLzQlNBBZf6PY31BhVuptPd-ZyccSq5kAQJPoBkUt4PHK">
        </div>
        <button class="action-btn btn-primary" onclick="testDiscordWebhook()">ğŸ§ª Test Discord</button>
      </div>
    </div>
    
    <div class="dashboard-card">
      <h2>ğŸ›¡ï¸ Security</h2>
      <div class="form-group">
        <label>Change Password</label>
        <input type="password" class="form-control" placeholder="New password" id="newPassword">
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" class="form-control" placeholder="Confirm new password" id="confirmPassword">
      </div>
      <button class="action-btn btn-warning" onclick="changePassword()">ğŸ” Change Password</button>
      
      <hr style="margin: 20px 0;">
      
      <div class="form-group">
        <label>Data Backup</label>
        <button class="action-btn btn-info" onclick="backupData()">ğŸ’¾ Download Backup</button>
        <button class="action-btn btn-warning" onclick="restoreData()">ğŸ“¥ Restore Data</button>
      </div>
      
      <hr style="margin: 20px 0;">
      
      <div class="form-group">
        <label>Data Management</label>
        <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">Reset all data including orders, inventory, customers, and activities. This action cannot be undone.</p>
        <button class="action-btn btn-danger" onclick="confirmResetAllData()" style="background-color: #dc3545;">ğŸ—‘ï¸ Reset All Data</button>
      </div>
    </div>
  </div>

  <!-- Debug & Fallbacks Tab -->
  <div class="tab-content" id="debug">
    <div class="dashboard-grid">
      <!-- System Status Card -->
      <div class="dashboard-card">
        <h2>ğŸ” System Diagnostics</h2>
        <div id="systemStatus">
          <div class="status-indicator" id="backendStatus">
            <span class="status-dot status-checking"></span>
            <span>Backend Connection: Checking...</span>
          </div>
          <div class="status-indicator" id="emailStatus">
            <span class="status-dot status-checking"></span>
            <span>Email System: Checking...</span>
          </div>
          <div class="status-indicator" id="storageStatus">
            <span class="status-dot status-checking"></span>
            <span>Local Storage: Checking...</span>
          </div>
          <div class="status-indicator" id="mobileStatus">
            <span class="status-dot status-checking"></span>
            <span>Mobile Compatibility: Checking...</span>
          </div>
        </div>
        <div style="margin-top: 20px;">
          <button class="action-btn btn-primary" onclick="runFullSystemDiagnostic()">ğŸ”„ Run Full Diagnostic</button>
          <button class="action-btn btn-info" onclick="testBackendEndpoints()">ğŸ”Œ Test Backend</button>
        </div>
      </div>

      <!-- Pending Email Notifications -->
      <div class="dashboard-card">
        <h2>ğŸ“§ Pending Email Notifications</h2>
        <div id="pendingEmailsCount" class="metric-value">Loading...</div>
        <div id="pendingEmailsList" style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
          <!-- Pending emails will be populated here -->
        </div>
        <div style="margin-top: 15px;">
          <button class="action-btn btn-success" onclick="processPendingEmails()">âœ‰ï¸ Process All Emails</button>
          <button class="action-btn btn-warning" onclick="clearProcessedEmails()">ğŸ—‘ï¸ Clear Processed</button>
          <button class="action-btn btn-info" onclick="exportEmailQueue()">ğŸ’¾ Export Queue</button>
        </div>
      </div>

      <!-- Mobile Testing Tools -->
      <div class="dashboard-card">
        <h2>ğŸ“± Mobile Testing</h2>
        <div id="deviceInfo">
          <p><strong>Current Device:</strong> <span id="deviceType">Unknown</span></p>
          <p><strong>Screen Size:</strong> <span id="screenSize">Unknown</span></p>
          <p><strong>Touch Support:</strong> <span id="touchSupport">Unknown</span></p>
          <p><strong>Orientation:</strong> <span id="orientation">Unknown</span></p>
        </div>
        <div style="margin-top: 20px;">
          <button class="action-btn btn-primary" onclick="testMobileLayout()">ğŸ“± Test Mobile Layout</button>
          <button class="action-btn btn-info" onclick="testTouchInterface()">ğŸ‘† Test Touch Interface</button>
          <button class="action-btn btn-warning" onclick="simulateMobileView()">ğŸ“² Simulate Mobile View</button>
        </div>
      </div>

      <!-- Fallback Systems -->
      <div class="dashboard-card">
        <h2>ğŸ›¡ï¸ Fallback Systems</h2>
        <div id="fallbackStatus">
          <div class="fallback-item">
            <span>ğŸ“§ Email Fallback:</span>
            <span class="status-badge status-active" id="emailFallbackStatus">Active</span>
          </div>
          <div class="fallback-item">
            <span>ğŸ’¾ Local Storage Backup:</span>
            <span class="status-badge status-active" id="storageFallbackStatus">Active</span>
          </div>
          <div class="fallback-item">
            <span>ğŸ”” Visual Notifications:</span>
            <span class="status-badge status-active" id="notificationFallbackStatus">Active</span>
          </div>
        </div>
        <div style="margin-top: 20px;">
          <button class="action-btn btn-success" onclick="testFallbackSystems()">ğŸ§ª Test Fallback Systems</button>
          <button class="action-btn btn-info" onclick="toggleFallbackMode()">ğŸ”„ Toggle Fallback Mode</button>
        </div>
      </div>

      <!-- Admin Notifications -->
      <div class="dashboard-card">
        <h2>ğŸ”” Admin Notifications</h2>
        <div id="adminNotificationsList" style="max-height: 250px; overflow-y: auto;">
          <!-- Admin notifications will be populated here -->
        </div>
        <div style="margin-top: 15px;">
          <button class="action-btn btn-primary" onclick="markAllNotificationsRead()">âœ… Mark All Read</button>
          <button class="action-btn btn-warning" onclick="clearOldNotifications()">ğŸ—‘ï¸ Clear Old</button>
        </div>
      </div>

      <!-- Emergency Manual Override -->
      <div class="dashboard-card">
        <h2>ğŸš¨ Emergency Manual Override</h2>
        <div class="emergency-controls">
          <div class="form-group">
            <label>Manual Email Processing</label>
            <textarea class="form-control" id="manualEmailContent" placeholder="Enter email content to send manually..." rows="4"></textarea>
          </div>
          <div class="form-group">
            <label>Recipient Email</label>
            <input type="email" class="form-control" id="manualEmailRecipient" placeholder="Enter recipient email">
          </div>
          <div class="form-group">
            <label>Subject</label>
            <input type="text" class="form-control" id="manualEmailSubject" placeholder="Enter email subject">
          </div>
          <button class="action-btn btn-danger" onclick="sendManualEmail()">ğŸ“¤ Send Manual Email</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Modal Title</h3>
      <button class="close-modal" onclick="closeModal()">&times;</button>
    </div>
    <div id="modalBody">
      <!-- Modal content will be populated here -->
    </div>
  </div>
</div>

<script>
// Global variables
let currentUser = null;
let adminUsers = [
  {
    id: 'admin-jackwicks',
    username: 'jackwicks',
    fullName: 'Jack Wicks',
    email: 'jack@cupcakesontheavenue.com',
    password: 'cupcakes2025',
    role: 'admin',
    createdAt: new Date().toISOString(),
    lastLogin: null,
    isActive: true
  }
];
let activityLog = [];
let orders = [];
let customers = [];
let inventory = [];
let blockedDates = [];
let currentDate = new Date();
let charts = {};

// Initialize app
function initializeApp() {
  // Load data from localStorage
  loadDataFromStorage();
  
  // Show login screen initially
  showLoginScreen();
  
  // Initialize PWA features
  initializePWA();
}

function loadDataFromStorage() {
  try {
    const savedUsers = localStorage.getItem('adminUsers');
    if (savedUsers) {
      adminUsers = JSON.parse(savedUsers);
    }
    
    const savedOrders = localStorage.getItem('adminOrders');
    if (savedOrders) {
      orders = JSON.parse(savedOrders);
    }
    
    const savedCustomers = localStorage.getItem('adminCustomers');
    if (savedCustomers) {
      customers = JSON.parse(savedCustomers);
    }
    
    const savedInventory = localStorage.getItem('adminInventory');
    if (savedInventory) {
      inventory = JSON.parse(savedInventory);
    }
    
    const savedActivityLog = localStorage.getItem('activityLog');
    if (savedActivityLog) {
      activityLog = JSON.parse(savedActivityLog);
    }
    
    const savedBlockedDates = localStorage.getItem('adminBlockedDates');
    if (savedBlockedDates) {
      blockedDates = JSON.parse(savedBlockedDates);
    }
  } catch (error) {
    console.error('Error loading data from storage:', error);
  }
}

function showLoginScreen() {
  document.getElementById('loginContainer').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
}

function showDashboard() {
  document.getElementById('loginContainer').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  updateDashboardData();
}

function setupEventListeners() {
  // Login form
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', handleLogin);
  }
  
  // Signup form
  const signupForm = document.getElementById('signupForm');
  if (signupForm) {
    signupForm.addEventListener('submit', handleSignup);
  }
  
  // Logout button
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', handleLogout);
  }
  
  // Refresh button
  const refreshBtn = document.getElementById('refreshAll');
  if (refreshBtn) {
    refreshBtn.addEventListener('click', refreshAllData);
  }
  
  // Tab navigation
  const navTabs = document.querySelectorAll('.nav-tab');
  navTabs.forEach(tab => {
    tab.addEventListener('click', (e) => {
      const tabName = e.target.getAttribute('data-tab');
      switchTab(tabName);
    });
  });
}

function handleLogin(e) {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  
  console.log('Login attempt:', username);
  
  if (!username || !password) {
    showError('errorMessage', 'Please enter both username and password');
    return;
  }
  
  // Check if user exists
  const user = adminUsers.find(u => u.username === username);
  
  if (!user) {
    showError('errorMessage', 'User not found');
    return;
  }
  
  // Verify password
  if (user.password !== password) {
    logActivity('security', 'Failed login attempt', `Username: ${username}`);
    showError('errorMessage', 'Invalid password');
    return;
  }
  
  authenticateUser(user);
}

function handleSignup(e) {
  e.preventDefault();
  const fullName = document.getElementById('signupFullName').value.trim();
  const username = document.getElementById('signupUsername').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const role = document.getElementById('userRole').value;
  
  if (!fullName || !username || !email || !password || !role) {
    showError('signupErrorMessage', 'Please fill in all fields');
    return;
  }
  
  if (password !== confirmPassword) {
    showError('signupErrorMessage', 'Passwords do not match');
    return;
  }
  
  // Check if username already exists
  const existingUser = adminUsers.find(u => u.username === username);
  if (existingUser) {
    showError('signupErrorMessage', 'Username already exists');
    return;
  }
  
  // Create new user
  const newUser = {
    id: 'admin-' + Date.now(),
    username: username,
    fullName: fullName,
    email: email,
    password: password,
    role: role,
    createdAt: new Date().toISOString(),
    lastLogin: null,
    isActive: true
  };
  
  adminUsers.push(newUser);
  localStorage.setItem('adminUsers', JSON.stringify(adminUsers));
  
  logActivity('admin', 'New user account created', `User: ${fullName} (${username})`);
  
  // Clear form
  document.getElementById('signupForm').reset();
  
  // Show success message and switch to login
  alert('Account created successfully! Please log in.');
  showLogin();
}

function authenticateUser(user) {
  currentUser = user;
  user.lastLogin = new Date().toISOString();
  
  // Update user in storage
  const userIndex = adminUsers.findIndex(u => u.id === user.id);
  if (userIndex !== -1) {
    adminUsers[userIndex] = user;
    localStorage.setItem('adminUsers', JSON.stringify(adminUsers));
  }
  
  // Log successful login
  logActivity('security', 'Successful login', `User: ${user.fullName}`);
  
  // Update UI
  document.getElementById('currentUserName').textContent = user.fullName;
  document.getElementById('currentUserRole').textContent = user.role;
  
  // Clear login form
  document.getElementById('loginForm').reset();
  clearError('errorMessage');
  
  // Show dashboard
  showDashboard();
}

function handleLogout() {
  if (currentUser) {
    logActivity('security', 'User logout', `User: ${currentUser.fullName}`);
  }
  
  currentUser = null;
  showLoginScreen();
}

function showError(elementId, message) {
  const errorElement = document.getElementById(elementId);
  if (errorElement) {
    errorElement.textContent = message;
    errorElement.style.display = 'block';
  }
}

function clearError(elementId) {
  const errorElement = document.getElementById(elementId);
  if (errorElement) {
    errorElement.textContent = '';
    errorElement.style.display = 'none';
  }
}

function showLogin() {
  document.getElementById('loginView').style.display = 'block';
  document.getElementById('signupView').style.display = 'none';
}

function showSignup() {
  document.getElementById('loginView').style.display = 'none';
  document.getElementById('signupView').style.display = 'block';
}

function switchTab(tabName) {
 

  // Update tab buttons
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
  if (activeTab) {
    activeTab.classList.add('active');
  }
  
  // Update tab content
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  const activeContent = document.getElementById(tabName);
  if (activeContent) {
    activeContent.classList.add('active');
  }
  
  // Update sidebar active state
  document.querySelectorAll('.nav-sidebar-item').forEach(item => {
    item.classList.remove('active');
  });
  const activeSidebarItem = document.querySelector(`.nav-sidebar-item[data-tab="${tabName}"]`);
  if (activeSidebarItem) {
    activeSidebarItem.classList.add('active');
  }
  
  // Load specific tab data
  switch(tabName) {
    case 'overview':
      updateOverviewData();
      break;
    case 'orders':
      loadOrdersData();
      break;
    case 'customers':
      loadCustomersData();
      break;
    case 'calendar':
      generateCalendar();
      break;
    case 'analytics':
      updateAnalyticsCharts();
      break;
    case 'inventory':
      loadInventoryData();
      break;
    case 'finances':
      loadFinancialData();
      break;
    case 'debug':
      initializeDebugTab();
      break;
    case 'communications':
      updateCustomerDropdown();
      loadCommunicationHistory();
      break;
    case 'activity':
      loadActivityLogData();
      break;
    case 'settings':
      loadSettingsData();
      break;
  }
}

function updateDashboardData() {
  updateOverviewData();
  document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
}

function updateOverviewData() {
  // Update stats with current data
  document.getElementById('todayOrders').textContent = orders.filter(o => 
    new Date(o.createdAt).toDateString() === new Date().toDateString()
  ).length;
  
  document.getElementById('todayRevenue').textContent = 'Â£' + orders
    .filter(o => new Date(o.createdAt).toDateString() === new Date().toDateString())
    .reduce((sum, o) => sum + (parseFloat(o.total) || 0), 0)
    .toFixed(2);
  
  document.getElementById('pendingOrders').textContent = orders.filter(o => o.status === 'pending').length;
  document.getElementById('totalCustomers').textContent = customers.length;
}

function loadOrdersData() {
  const tbody = document.getElementById('ordersTableBody');
  if (!tbody) return;
  
  tbody.innerHTML = orders.map(order => `
    <tr>
      <td>${order.id}</td>
      <td>${order.customerName}</td>
      <td>${order.items}</td>
      <td>Â£${order.total}</td>
      <td><span class="status-badge status-${order.status}">${order.status}</span></td>
      <td><span class="status-badge status-${order.paymentStatus}">${order.paymentStatus}</span></td>
      <td>${order.deliveryDate}</td>
      <td>
        <button class="action-btn btn-info" onclick="viewOrder('${order.id}')">View</button>
        <button class="action-btn btn-warning" onclick="editOrder('${order.id}')">Edit</button>
      </td>
    </tr>
  `).join('');
}

function loadCustomersData() {
  const tbody = document.getElementById('customersTableBody');
  if (!tbody) return;
  
  tbody.innerHTML = customers.map(customer => `
    <tr>
      <td>${customer.name}</td>
      <td>${customer.email}</td>
      <td>${customer.phone || 'N/A'}</td>
      <td>${customer.totalOrders || 0}</td>
      <td>Â£${customer.totalSpent || '0.00'}</td>
      <td>${customer.lastOrder || 'Never'}</td>
      <td>${customer.loyaltyPoints || 0}</td>
      <td>
        <button class="action-btn btn-info" onclick="viewCustomer('${customer.id}')">View</button>
        <button class="action-btn btn-warning" onclick="editCustomer('${customer.id}')">Edit</button>
      </td>
    </tr>
  `).join('');
}

function loadActivityLogData() {
  const container = document.getElementById('activityLogList');
  if (!container) return;
  
  container.innerHTML = activityLog.slice(-50).reverse().map(log => `
    <div class="activity-item">
      <strong>${log.timestamp}</strong> - ${log.user} - ${log.action}: ${log.details}
    </div>
  `).join('');
}

function logActivity(category, action, details) {
  const logEntry = {
    id: Date.now(),
    timestamp: new Date().toLocaleString(),
    user: currentUser ? currentUser.fullName : 'System',
    category: category,
    action: action,
    details: details
  };
  
  activityLog.push(logEntry);
  localStorage.setItem('activityLog', JSON.stringify(activityLog));
}

function refreshAllData() {
  loadDataFromStorage();
  updateDashboardData();
  
  // Refresh current tab
  const activeTab = document.querySelector('.nav-tab.active');
  if (activeTab) {
    const tabName = activeTab.getAttribute('data-tab');
    switchTab(tabName);
  }
  
  showNotification('Data refreshed successfully', 'success');
}

function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <p>${message}</p>
  `;
  
  const panel = document.getElementById('notificationPanel');
  panel.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 5000);
}

// Initialize mobile navigation
function setupMobileNavigation() {
  const mobileToggle = document.getElementById('mobileNavToggle');
  const sidebar = document.getElementById('navSidebar');
  const overlay = document.getElementById('navSidebarOverlay');
  const sidebarItems = document.querySelectorAll('.nav-sidebar-item');
  
  if (!mobileToggle || !sidebar || !overlay) return;
  
  // Toggle sidebar
  mobileToggle.addEventListener('click', () => {
    sidebar.classList.add('open');
    overlay.classList.add('show');
  });
  
  // Close sidebar when clicking overlay
  overlay.addEventListener('click', () => {
    closeMobileNav();
  });
  
  // Handle sidebar navigation
  sidebarItems.forEach(item => {
    item.addEventListener('click', () => {
      const tabName = item.dataset.tab;
      switchTab(tabName);
      closeMobileNav();
    });
  });
}

function closeMobileNav() {
  document.getElementById('navSidebar').classList.remove('open');
  document.getElementById('navSidebarOverlay').classList.remove('show');
}

// Reset data function
function resetToCleanData() {
  // Keep only the Jack Wicks admin user
  adminUsers = [
    {
      id: 'admin-jackwicks',
      username: 'jackwicks',
      fullName: 'Jack Wicks',
      email: 'jack@cupcakesontheavenue.com',
      password: 'cupcakes2025',
      role: 'admin',
      createdAt: new Date().toISOString(),
      lastLogin: null,
      isActive: true
    }
  ];
  
  // Clear all other data
  orders = [];
  customers = [];
  inventory = [];
  blockedDates = [];
  activityLog = [];
  
  // Save clean data to localStorage
  localStorage.setItem('adminUsers', JSON.stringify(adminUsers));
  localStorage.setItem('adminOrders', JSON.stringify(orders));
  localStorage.setItem('adminCustomers', JSON.stringify(customers));
  localStorage.setItem('adminInventory', JSON.stringify(inventory));
  localStorage.setItem('adminBlockedDates', JSON.stringify(blockedDates));
  localStorage.setItem('activityLog', JSON.stringify(activityLog));
  
  console.log('âœ… Data reset - only Jack Wicks admin account retained');
}

// PWA initialization
function initializePWA() {
  // Hide app loading screen after initialization
  setTimeout(() => {
    const loadingScreen = document.getElementById('appLoading');
    if (loadingScreen) {
      loadingScreen.classList.add('hidden');
    }
  }, 1000);
}

// Stub functions for missing functionality
function loadFinancialData() { console.log('Loading financial data...'); }
function generateCalendar() { console.log('Generating calendar...'); }
function updateAnalyticsCharts() { console.log('Updating analytics charts...'); }
function initializeDebugTab() { console.log('Initializing debug tab...'); }
function updateCustomerDropdown() { console.log('Updating customer dropdown...'); }
function loadCommunicationHistory() { console.log('Loading communication history...'); }
function loadSettingsData() {
  if (currentUser) {
    const businessName = document.getElementById('businessName');
    const businessPhone = document.getElementById('businessPhone');
    const businessEmail = document.getElementById('businessEmail');
    const leadTime = document.getElementById('leadTime');
    
    if (businessName) businessName.value = 'Cupcakes on the Avenue';
    if (businessPhone) businessPhone.value = '07842817789';
    if (businessEmail) businessEmail.value = currentUser.email;
    if (leadTime) leadTime.value = '7';
  }
}
function setupAutoSync() { console.log('Setting up auto sync...'); }

// === EMAIL INTEGRATION ===
async function sendEmail(to, subject, content, type = 'order') {
  try {
    const response = await fetch('https://sumup-backend.vercel.app/api/send-email', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: to,
        subject: subject,
        content: content,
        type: type
      })
    });
    
    if (response.ok) {
      logActivity('communication', 'Email sent', `To: ${to}, Subject: ${subject}`);
      return true;
    } else {
      console.error('Email failed:', await response.text());
      return false;
    }
  } catch (error) {
    console.error('Email error:', error);
    return false;
  }
}

// === DISCORD INTEGRATION ===
async function sendDiscordNotification(message, orderData = null) {
  try {
    const discordWebhook = 'https://discord.com/api/webhooks/1426192909044023297/Ilgqgr8p7buI95ai-zssfphPLzQlNBBZf6PY31BhVuptPd-ZyccSq5kAQJPoBkUt4PHK';
    
    let payload;
    if (orderData) {
      payload = {
        embeds: [{
          title: 'ğŸ§ New Order!',
          color: 0x667eea,
          fields: [
            { name: 'ğŸ“‹ Reference', value: orderData.reference, inline: true },
            { name: 'ğŸ’° Total', value: orderData.total, inline: true },
            { name: 'ğŸ‘¤ Customer', value: orderData.name, inline: false },
            { name: 'ğŸ“§ Email', value: orderData.email, inline: true },
            { name: 'ğŸ“± Mobile', value: orderData.mobile || 'Not provided', inline: true },
            { name: 'ğŸšš Delivery', value: orderData.delivery, inline: true },
            { name: 'ğŸ“… Date', value: orderData.date, inline: true },
            { name: 'ğŸ“ Address', value: orderData.address || 'Collection', inline: false }
          ],
          timestamp: new Date().toISOString(),
          footer: { text: 'Cupcakes on the Avenue' }
        }]
      };
    } else {
      payload = { content: message };
    }
    
    const response = await fetch(discordWebhook, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    
    if (response.ok) {
      logActivity('communication', 'Discord notification sent', message);
      return true;
    }
    return false;
  } catch (error) {
    console.error('Discord error:', error);
    return false;
  }
}

// === CALENDAR FUNCTIONS ===
function generateCalendar() {
  const calendar = document.getElementById('orderCalendar');
  if (!calendar) return;
  
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  
  document.getElementById('currentMonth').textContent = 
    new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  
  let calendarHTML = `
    <div class="calendar-header">Sun</div>
    <div class="calendar-header">Mon</div>
    <div class="calendar-header">Tue</div>
    <div class="calendar-header">Wed</div>
    <div class="calendar-header">Thu</div>
    <div class="calendar-header">Fri</div>
    <div class="calendar-header">Sat</div>
  `;
  
  // Empty cells for days before month starts
  for (let i = 0; i < firstDay; i++) {
    calendarHTML += '<div class="calendar-day"></div>';
  }
  
  // Days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const hasOrders = orders.some(order => order.deliveryDate === dateStr);
    const isBlocked = blockedDates.includes(dateStr);
    
    let dayClass = 'calendar-day';
    if (hasOrders) dayClass += ' has-orders';
    if (isBlocked) dayClass += ' blocked';
    
    calendarHTML += `
      <div class="${dayClass}" data-date="${dateStr}">
        ${day}
        ${hasOrders ? '<div class="order-dot"></div>' : ''}
      </div>
    `;
  }
  
  calendar.innerHTML = calendarHTML;
}

function prevMonth() {
  currentDate.setMonth(currentDate.getMonth() - 1);
  generateCalendar();
}

function nextMonth() {
  currentDate.setMonth(currentDate.getMonth() + 1);
  generateCalendar();
}

function blockDate() {
  const dateInput = document.getElementById('blockDate');
  const date = dateInput.value;
  
  if (!date) {
    alert('Please select a date to block');
    return;
  }
  
  if (!blockedDates.includes(date)) {
    blockedDates.push(date);
    localStorage.setItem('adminBlockedDates', JSON.stringify(blockedDates));
    generateCalendar();
    updateBlockedDatesList();
    logActivity('calendar', 'Date blocked', `Date: ${date}`);
    showNotification(`Date ${date} has been blocked`, 'success');
  }
  
  dateInput.value = '';
}

function updateBlockedDatesList() {
  const container = document.getElementById('blockedDatesList');
  if (!container) return;
  
  container.innerHTML = blockedDates.map(date => `
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin: 4px 0; background: #f8f9fa; border-radius: 4px;">
      <span>${date}</span>
      <button class="action-btn btn-danger" onclick="unblockDate('${date}')">Remove</button>
    </div>
  `).join('');
}

function unblockDate(date) {
  blockedDates = blockedDates.filter(d => d !== date);
  localStorage.setItem('adminBlockedDates', JSON.stringify(blockedDates));
  generateCalendar();
  updateBlockedDatesList();
  logActivity('calendar', 'Date unblocked', `Date: ${date}`);
  showNotification(`Date ${date} has been unblocked`, 'success');
}

// === INVENTORY FUNCTIONS ===
function loadInventoryData() {
  const tbody = document.getElementById('inventoryTableBody');
  if (!tbody) return;
  
  if (inventory.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">No inventory items. Click "Add Item" to start tracking stock.</td></tr>';
    return;
  }
  
  tbody.innerHTML = inventory.map(item => `
    <tr>
      <td>${item.name}</td>
      <td>${item.currentStock}</td>
      <td>${item.lowStockAlert}</td>
      <td>Â£${item.unitCost}</td>
      <td><span class="status-badge ${item.currentStock <= item.lowStockAlert ? 'status-cancelled' : 'status-confirmed'}">${item.currentStock <= item.lowStockAlert ? 'Low Stock' : 'In Stock'}</span></td>
      <td>
        <button class="action-btn btn-warning" onclick="editInventoryItem('${item.id}')">Edit</button>
        <button class="action-btn btn-danger" onclick="deleteInventoryItem('${item.id}')">Delete</button>
      </td>
    </tr>
  `).join('');
}

function addInventoryItem() {
  const item = {
    id: 'inv-' + Date.now(),
    name: prompt('Item name:'),
    currentStock: parseInt(prompt('Current stock:')) || 0,
    lowStockAlert: parseInt(prompt('Low stock alert level:')) || 5,
    unitCost: parseFloat(prompt('Unit cost (Â£):')) || 0
  };
  
  if (item.name) {
    inventory.push(item);
    localStorage.setItem('adminInventory', JSON.stringify(inventory));
    loadInventoryData();
    logActivity('inventory', 'Item added', `Item: ${item.name}`);
    showNotification(`${item.name} added to inventory`, 'success');
  }
}

function editInventoryItem(id) {
  const item = inventory.find(i => i.id === id);
  if (!item) return;
  
  const newName = prompt('Item name:', item.name);
  const newStock = parseInt(prompt('Current stock:', item.currentStock));
  const newAlert = parseInt(prompt('Low stock alert:', item.lowStockAlert));
  const newCost = parseFloat(prompt('Unit cost (Â£):', item.unitCost));
  
  if (newName) {
    item.name = newName;
    item.currentStock = newStock || 0;
    item.lowStockAlert = newAlert || 5;
    item.unitCost = newCost || 0;
    
    localStorage.setItem('adminInventory', JSON.stringify(inventory));
    loadInventoryData();
    logActivity('inventory', 'Item updated', `Item: ${item.name}`);
    showNotification(`${item.name} updated`, 'success');
  }
}

function deleteInventoryItem(id) {
  const item = inventory.find(i => i.id === id);
  if (!item) return;
  
  if (confirm(`Delete ${item.name} from inventory?`)) {
    inventory = inventory.filter(i => i.id !== id);
    localStorage.setItem('adminInventory', JSON.stringify(inventory));
    loadInventoryData();
    logActivity('inventory', 'Item deleted', `Item: ${item.name}`);
    showNotification(`${item.name} removed from inventory`, 'success');
  }
}

// === ANALYTICS FUNCTIONS ===
function updateAnalyticsCharts() {
  // Revenue Chart
  const revenueCtx = document.getElementById('revenueChart');
  if (revenueCtx && window.Chart) {
    if (charts.revenue) charts.revenue.destroy();
    
    const last7Days = [];
    const revenues = [];
    for (let i = 6; i >= 0; i--) {
      const date = new Date();
      date.setDate(date.getDate() - i);
      const dateStr = date.toDateString();
      last7Days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
      
      const dayRevenue = orders
        .filter(o => new Date(o.createdAt).toDateString() === dateStr)
        .reduce((sum, o) => sum + (parseFloat(o.total) || 0), 0);
      revenues.push(dayRevenue);
    }
    
    charts.revenue = new Chart(revenueCtx, {
      type: 'line',
      data: {
        labels: last7Days,
        datasets: [{
          label: 'Revenue (Â£)',
          data: revenues,
          borderColor: '#667eea',
          backgroundColor: 'rgba(102, 126, 234, 0.1)',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false
      }
    });
  }
}

// === COMMUNICATIONS FUNCTIONS ===
function updateCustomerDropdown() {
  const dropdown = document.getElementById('individualCustomer');
  if (!dropdown) return;
  
  dropdown.innerHTML = '<option value="">Choose a customer...</option>' +
    customers.map(c => `<option value="${c.id}">${c.name} (${c.email})</option>`).join('');
}

function loadCommunicationHistory() {
  const tbody = document.getElementById('communicationHistory');
  if (!tbody) return;
  
  const commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
  
  tbody.innerHTML = commHistory.slice(-20).reverse().map(comm => `
    <tr>
      <td>${comm.date}</td>
      <td>${comm.customer}</td>
      <td>${comm.method}</td>
      <td>${comm.message.substring(0, 50)}...</td>
      <td><span class="status-badge status-${comm.status}">${comm.status}</span></td>
    </tr>
  `).join('');
}

function sendPushNotification() {
  const type = document.getElementById('notificationType').value;
  const message = document.getElementById('notificationMessage').value;
  
  if (!message) {
    alert('Please enter a notification message');
    return;
  }
  
  // Simulate sending notification
  showNotification('Push notification sent to all customers', 'success');
  logActivity('communication', 'Push notification sent', `Type: ${type}, Message: ${message.substring(0, 50)}...`);
  
  // Clear form
  document.getElementById('notificationMessage').value = '';
}

function contactIndividualCustomer() {
  const customerId = document.getElementById('individualCustomer').value;
  const method = document.getElementById('contactMethod').value;
  const message = document.getElementById('individualMessage').value;
  
  if (!customerId || !message) {
    alert('Please select a customer and enter a message');
    return;
  }
  
  const customer = customers.find(c => c.id === customerId);
  if (!customer) return;
  
  // Save communication record
  const commHistory = JSON.parse(localStorage.getItem('communicationHistory') || '[]');
  commHistory.push({
    id: Date.now(),
    date: new Date().toLocaleDateString(),
    customer: customer.name,
    method: method,
    message: message,
    status: 'sent'
  });
  localStorage.setItem('communicationHistory', JSON.stringify(commHistory));
  
  showNotification(`${method} sent to ${customer.name}`, 'success');
  logActivity('communication', `${method} sent`, `To: ${customer.name}`);
  
  // Clear form
  document.getElementById('individualMessage').value = '';
  loadCommunicationHistory();
}

// === FINANCIAL FUNCTIONS ===
function loadFinancialData() {
  // Update financial overview with real data
  const todayRevenue = orders
    .filter(o => new Date(o.createdAt).toDateString() === new Date().toDateString())
    .reduce((sum, o) => sum + (parseFloat(o.total) || 0), 0);
  
  const weekRevenue = orders
    .filter(o => {
      const orderDate = new Date(o.createdAt);
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      return orderDate >= weekAgo;
    })
    .reduce((sum, o) => sum + (parseFloat(o.total) || 0), 0);
  
  // Update the financial overview display
  document.querySelectorAll('.dashboard-card').forEach(card => {
    if (card.querySelector('h2')?.textContent.includes('Financial Overview')) {
      const statItems = card.querySelectorAll('.stat-value');
      if (statItems[0]) statItems[0].textContent = `Â£${todayRevenue.toFixed(2)}`;
      if (statItems[1]) statItems[1].textContent = `Â£${weekRevenue.toFixed(2)}`;
    }
  });
}

// === DEBUG TAB FUNCTIONS ===
function initializeDebugTab() {
  // Update system status
  updateSystemStatus();
  updateDeviceInfo();
  loadPendingEmails();
  loadAdminNotifications();
}

function updateSystemStatus() {
  // Test backend connection
  fetch('https://sumup-backend.vercel.app/api/env-check')
    .then(response => response.json())
    .then(data => {
      updateStatusIndicator('backendStatus', 'online', 'Backend Connection: Online');
    })
    .catch(() => {
      updateStatusIndicator('backendStatus', 'offline', 'Backend Connection: Offline');
    });
  
  // Test email system
  updateStatusIndicator('emailStatus', 'online', 'Email System: Configured');
  
  // Test local storage
  try {
    localStorage.setItem('test', 'test');
    localStorage.removeItem('test');
    updateStatusIndicator('storageStatus', 'online', 'Local Storage: Working');
  } catch {
    updateStatusIndicator('storageStatus', 'offline', 'Local Storage: Error');
  }
  
  // Check mobile compatibility
  const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  updateStatusIndicator('mobileStatus', 'online', `Mobile Compatibility: ${isMobile ? 'Mobile Device' : 'Desktop'}`);
}

function updateStatusIndicator(elementId, status, text) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  const dot = element.querySelector('.status-dot');
  const span = element.querySelector('span:last-child');
  
  if (dot) {
    dot.className = `status-dot status-${status}`;
  }
  if (span) {
    span.textContent = text;
  }
}

function updateDeviceInfo() {
  document.getElementById('deviceType').textContent = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop';
  document.getElementById('screenSize').textContent = `${screen.width}x${screen.height}`;
  document.getElementById('touchSupport').textContent = 'ontouchstart' in window ? 'Yes' : 'No';
  document.getElementById('orientation').textContent = screen.orientation ? screen.orientation.type : 'Unknown';
}

function loadPendingEmails() {
  const pendingEmails = JSON.parse(localStorage.getItem('pendingEmails') || '[]');
  document.getElementById('pendingEmailsCount').textContent = `${pendingEmails.length} pending emails`;
  
  const container = document.getElementById('pendingEmailsList');
  if (container) {
    container.innerHTML = pendingEmails.slice(-10).map(email => `
      <div class="pending-email-item">
        <div class="pending-email-header">
          <span class="pending-email-type">${email.type}</span>
          <span class="pending-email-time">${email.timestamp}</span>
        </div>
        <div class="pending-email-preview">${email.subject}</div>
      </div>
    `).join('');
  }
}

function loadAdminNotifications() {
  const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
  const container = document.getElementById('adminNotificationsList');
  
  if (container) {
    container.innerHTML = notifications.slice(-10).reverse().map(notif => `
      <div class="notification-item ${notif.read ? '' : 'unread'}">
        <span class="notification-icon">${notif.icon}</span>
        <div class="notification-content">
          <div>${notif.message}</div>
          <div class="notification-time">${notif.timestamp}</div>
        </div>
      </div>
    `).join('');
  }
}

// === MODAL FUNCTIONS ===
function openModal(title, content) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').innerHTML = content;
  document.getElementById('modal').style.display = 'block';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

function viewOrder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;
  
  openModal('Order Details', `
    <div class="form-group">
      <strong>Order ID:</strong> ${order.id}<br>
      <strong>Customer:</strong> ${order.customerName}<br>
      <strong>Items:</strong> ${order.items}<br>
      <strong>Total:</strong> Â£${order.total}<br>
      <strong>Status:</strong> ${order.status}<br>
      <strong>Delivery Date:</strong> ${order.deliveryDate}
    </div>
  `);
}

function viewCustomer(customerId) {
  const customer = customers.find(c => c.id === customerId);
  if (!customer) return;
  
  openModal('Customer Details', `
    <div class="form-group">
      <strong>Name:</strong> ${customer.name}<br>
      <strong>Email:</strong> ${customer.email}<br>
      <strong>Phone:</strong> ${customer.phone || 'N/A'}<br>
      <strong>Total Orders:</strong> ${customer.totalOrders || 0}<br>
      <strong>Total Spent:</strong> Â£${customer.totalSpent || '0.00'}
    </div>
  `);
}

// === SETTINGS FUNCTIONS ===
function saveSettings() {
  const settings = {
    businessName: document.getElementById('businessName').value,
    businessPhone: document.getElementById('businessPhone').value,
    businessEmail: document.getElementById('businessEmail').value,
    leadTime: document.getElementById('leadTime').value
  };
  
  localStorage.setItem('adminSettings', JSON.stringify(settings));
  logActivity('settings', 'Settings updated', 'Business settings saved');
  showNotification('Settings saved successfully', 'success');
}

function testDiscordWebhook() {
  sendDiscordNotification('ğŸ§ª Test notification from admin dashboard');
  showNotification('Test Discord notification sent', 'info');
}

// === PWA FUNCTIONS ===
function installApp() {
  // PWA install logic
  showNotification('App installation initiated', 'info');
  document.getElementById('installBanner').classList.remove('show');
}

function updateApp() {
  // PWA update logic
  showNotification('App will update on next reload', 'info');
  document.getElementById('appUpdateBanner').classList.remove('show');
}

function dismissInstall() {
  document.getElementById('installBanner').classList.remove('show');
}

function dismissUpdate() {
  document.getElementById('appUpdateBanner').classList.remove('show');
}

// Update the existing window.onload to include all initialization
window.addEventListener('DOMContentLoaded', () => {
  initializeApp();
  setupEventListeners();
  setupMobileNavigation();
  resetToCleanData();
  
  // Initialize charts after a delay
  setTimeout(() => {
    updateAnalyticsCharts();
  }, 1000);
  
  console.log('âœ… Admin dashboard fully initialized with all features');
  console.log('ğŸ”‘ Login: jackwicks / cupcakes2025');
});
</script>